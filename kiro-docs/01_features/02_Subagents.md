# Kiro CLI サブエージェント機能（Subagents）

**出典**: [【Kiro CLI v1.23.0】サブエージェント機能のご紹介](https://zenn.dev/aws_japan/articles/a2a33ed9a1e712) - Zenn記事 by konippi

## 概要

Kiro CLI v1.23.0（2025年12月18日リリース）で追加されたサブエージェント機能について詳細に解説します。この機能により、複雑なタスクを専門化されたエージェントに委譲し、並列実行可能になりました。メインエージェントのコンテキストを保ちながら、独立したサブエージェントが自律的にタスクを処理します。

## 📋 Zenn記事の詳細内容確認

### v1.23.0のサブエージェント機能の詳細

#### 主要な機能・特徴

1. **サブエージェント機能の本質**
   - 複雑なタスクを専門化されたエージェントに委譲
   - 並列実行による効率的なタスク処理
   - メインエージェントのコンテキストを保持しながら独立実行

2. **主な機能**
   - **自律実行**: 独自のコンテキストで独立して実行
   - **リアルタイム進捗追跡**: タスク実行中の状態をリアルタイムで確認
   - **コアツールへのアクセス**: ファイル読み書き、コマンド実行、MCPツール使用
   - **並列実行**: 複数のサブエージェントを同時実行
   - **結果の自動集約**: 完了時に結果がメインエージェントに自動返却

3. **サブエージェントの種類**
   - **デフォルトサブエージェント**: 汎用タスク処理用の標準エージェント
   - **カスタムサブエージェント**: 独自のエージェント設定を使用した特化型エージェント

4. **動作の仕組み**
   - タスクの割り当て → サブエージェントの初期化 → 自律実行 → 進捗更新 → 結果の返却

5. **利用可能・不可能なツール**
   - **利用可能**: read, write, shell, MCPツール
   - **利用不可**: web_search/web_fetch, introspect, thinking, todo, use_aws, grep/glob

6. **効果的な使い方のポイント**
   - 複雑なタスクに使用
   - 明確な指示を提供
   - 進捗を監視
   - 結果をレビュー

## サブエージェント機能詳細

### 基本概念

サブエージェント機能は、複雑なタスクを専門化されたエージェントに委譲し、並列実行可能にするツールです。メインエージェントのコンテキストを保ちながら、独立したサブエージェントが自律的にタスクを処理します。

> **重要**: 既存のエージェント設定でツールを制限している場合は、`subagent`ツールを許可リストに追加する必要があります。

### 主な機能

#### 1. 自律実行
- 独自のコンテキストで独立して実行される
- メインエージェントから独立したランタイム環境

#### 2. リアルタイム進捗追跡
- タスク実行中の状態をリアルタイムで確認可能
- 複数のサブエージェント並列実行時の状況把握

#### 3. コアツールへのアクセス
- ファイル読み書き（read/write）
- コマンド実行（shell）
- MCPツールの使用

#### 4. 並列実行
- 複数のサブエージェントを同時実行して効率的にタスクを処理
- フロントエンド・バックエンドの同時開発など

#### 5. 結果の自動集約
- 完了時に結果がメインエージェントに自動的に返される
- 統合された成果物の提供

### サブエージェントの種類

#### デフォルトサブエージェント
- Kiroに含まれる汎用タスク処理用の標準エージェント
- カスタムエージェントを指定しない場合に使用される
- 一般的な開発タスクに対応

#### カスタムサブエージェント
- 独自のエージェント設定を使用してサブエージェントを生成
- 特定のユースケースに特化させたエージェント作成が可能
- エージェント設定からツールアクセス権限や設定を引き継ぎ

**使用例**:
```
> 商品アイテムの一覧を返すAPIエンドポイントをbackendエージェント、商品アイテム一覧ページのUIコンポーネントをfrontendエージェントで実装して。
```

この例では、backendとfrontendの2つのサブエージェントが並列で実行されます。

### 動作の仕組み

サブエージェントは以下の5段階で動作します：

1. **タスクの割り当て**
   - タスクを説明すると、Kiroがサブエージェントの使用が適切かどうかを判断

2. **サブエージェントの初期化**
   - エージェント設定に基づいて、独自のコンテキストとツールアクセスを持つサブエージェントが作成

3. **自律実行**
   - サブエージェントが独立してタスクを処理
   - 特定のツール権限についてユーザー承認を求めることがある

4. **進捗更新**
   - 現在の作業状況をリアルタイムで確認可能

5. **結果の返却**
   - 完了時に結果がメインエージェントに返却

### 利用可能なツール

サブエージェントは独立したランタイム環境で動作するため、利用可能なツールが制限されています。

#### 利用可能なツール
- **read**: ファイルとディレクトリの読み取り
- **write**: ファイルの作成と編集
- **shell**: bashコマンドの実行
- **MCPツール**: Model Context Protocolツール

#### 利用不可能なツール
- **web_search / web_fetch**: Web検索・取得
- **introspect**: 自分自身（Kiro CLI）の情報
- **thinking**: 論理的な思考
- **todo**: タスク管理
- **use_aws**: AWSコマンドの呼び出し
- **grep / glob**: ファイル検索

> **注意**: カスタムエージェント設定にサブエージェントで利用できないツールが含まれている場合、そのツールはサブエージェント実行時に利用できなくなりますが、利用可能なツールによって動作は継続されます。

### 効果的な使い方

#### 1. 複雑なタスクに使用する
- 分離が有益なマルチステップ操作で最も価値を発揮
- 単純なタスクではなく、独立して処理できる複雑なタスクに使用
- メインエージェントのコンテキストを保ちながら効率的に作業を進行

#### 2. 明確な指示を提供する
- 具体的なタスク説明がより良い結果につながる
- **悪い例**: 「バックエンドを修正して」
- **良い例**: 「商品一覧を返すGET /api/productsエンドポイントを追加して」

#### 3. 進捗を監視する
- サブエージェントはリアルタイムで進捗が表示される
- 複数のサブエージェント並列実行時や長時間タスクでの状況確認が重要

#### 4. 結果をレビューする
- サブエージェントの出力は必ずレビューする
- 生成されたコードや変更内容が要件を満たしているか確認
- 推奨事項に基づいて行動する前の検証が重要

## 実用的なユースケース

### フロントエンド・バックエンド同時開発
```
> 商品管理機能を実装して。backendエージェントでREST APIを、frontendエージェントでReactコンポーネントを並行して作成して。
```

### データ処理とUI更新の並列実行
```
> データベースの移行スクリプトをdbエージェントで、管理画面の更新をadminエージェントで同時に進めて。
```

### テストとドキュメント作成の並行処理
```
> 新機能のユニットテストをtestエージェントで、APIドキュメントをdocsエージェントで並行して作成して。
```

## 設定とカスタマイズ

### カスタムエージェントの作成
カスタムエージェントの作成方法については、[公式ドキュメント](https://kiro.dev/docs/cli/custom-agents/creating/)を参照してください。

### ツール権限の設定
既存のエージェント設定でツールを制限している場合：
1. エージェント設定ファイルを開く
2. `allowedTools`リストに`subagent`を追加
3. 設定を保存してセッションを再起動

## トラブルシューティング

### よくある問題と解決方法

#### サブエージェントが起動しない
- `subagent`ツールが許可リストに含まれているか確認
- エージェント設定ファイルの構文エラーをチェック

#### 期待した結果が得られない
- タスクの指示をより具体的に記述
- 必要なツールがサブエージェントで利用可能か確認

#### 進捗が表示されない
- ネットワーク接続を確認
- Kiro CLIを最新バージョンに更新

## まとめ

Kiro CLI v1.23.0のサブエージェント機能は、複雑なタスクの並列実行を可能にする革新的な機能です。この機能により：

- **開発効率の大幅向上**: 複数のタスクを同時並行で処理
- **専門化されたワークフロー**: カスタムエージェントによる特化型処理
- **リアルタイム監視**: 進捗状況の即座把握
- **自動統合**: 結果の自動集約による一貫した成果物

特にカスタムエージェントと組み合わせることで、フロントエンドとバックエンドの同時開発など、より高度なワークフローを実現できます。

この機能は、AI駆動開発における新しい標準を確立し、開発者の生産性を飛躍的に向上させる重要なアップデートです。
