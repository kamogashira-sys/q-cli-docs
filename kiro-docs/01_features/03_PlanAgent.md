# Kiro CLI Planエージェント機能（Plan Agent）

**出典**: [【Kiro CLI v1.23.0】Plan エージェント機能のご紹介](https://zenn.dev/aws_japan/articles/bb704d31e5b059) - Zenn記事 by konippi

## 概要

Kiro CLI v1.23.0（2025年12月18日リリース）で追加されたPlanエージェント機能について詳細に解説します。この機能により、アイデアを構造化された実装計画に変換する専用のビルトインエージェントが利用可能になりました。要件収集、リサーチを通じて、実装前に詳細なタスク分解を作成し、その後実行モードに切り替えることができます。

## 📋 Zenn記事の詳細内容確認

### v1.23.0のPlanエージェント機能の詳細

#### 主要な機能・特徴

1. **Planエージェント機能の本質**
   - アイデアを構造化された実装計画に変換する専用のビルトインエージェント
   - 要件収集、リサーチを通じた詳細なタスク分解の作成
   - 実装前の計画立案に特化した設計

2. **起動方法（3つの方法）**
   - **キーボードショートカット**: `Shift + Tab`でPlanモードと実行モードを切り替え
   - **スラッシュコマンド**: `/plan`コマンドでPlanモードに切り替え
   - **プロンプトと同時起動**: `/plan 商品一覧を取得するAPIエンドポイントを実装したい`

3. **動作ステップ（4段階）**
   - **要件収集**: 構造化された質問を通じて初期アイデアを洗練
   - **リサーチと分析**: コードベース探索と関連技術のリサーチ
   - **実装計画の作成**: 詳細なステップバイステップの実装計画作成
   - **計画の承認と引き継ぎ**: ユーザー承認後の実行エージェントへの引き継ぎ

4. **読み取り専用設計**
   - 計画に集中するための読み取り専用モードで動作
   - ファイル読み取り、コードインテリジェンス、検索、Web検索は利用可能
   - ファイル書き込み、コマンド実行、MCPツールは利用不可

5. **効果的な使い方のポイント**
   - 複雑なタスクに使用
   - 質問に対して積極的に回答
   - 探索を許可
   - 計画をレビュー
   - 必要に応じて反復

6. **注意点**
   - 生成された仕様は専用ファイルとして保存されない
   - 永続化が必要な場合は実行モード切り替え前に保存を依頼

## Planエージェント機能詳細

### 基本概念

Planエージェントは、アイデアを構造化された実装計画に変換する専用のビルトインエージェントです。実装前の計画立案に特化し、要件収集からタスク分解まで体系的に支援します。

### 起動方法

#### 1. キーボードショートカット（推奨）
```
Shift + Tab
```
- Planモードと実行モードを相互切り替え
- 実装計画完成後の自動切り替えにも対応
- 最も効率的な操作方法

#### 2. スラッシュコマンド
```
> /plan
```
- コマンドラインからのPlanモード切り替え
- シンプルで直感的な操作

#### 3. プロンプトと同時起動
```
> /plan 商品一覧を取得するAPIエンドポイントを実装したい
```
- プロンプト入力と同時にPlanモードを起動
- 初期要件を含めた効率的な開始方法

### 動作ステップ

#### 1. 要件収集
Planエージェントは構造化された質問を通じて初期アイデアを洗練させます。

**特徴**:
- 抽象的な部分をより具体的に変換
- 「モダン」などの曖昧な表現を明確化
- 構造化された質問による要件の詳細化

**重要な原則**:
> 曖昧な指示は、曖昧な実装を生みます！

#### 2. リサーチと分析
コードベースを探索し、関連する技術をリサーチします。

**機能**:
- **コード探索**: code、grep、globツールを使用して既存コードを理解
- **技術リサーチ**: 関連するフレームワーク、ライブラリ、パターンを特定
- **アーキテクチャ分析**: 既存のプロジェクト構造と規約をレビュー

**プロセス**:
1. ユーザーに追加調査すべき項目を確認
2. リサーチの方向性を決定
3. 既存の知識を含めた包括的な分析

#### 3. 実装計画の作成
明確な目標を持つ詳細なステップバイステップの実装計画を作成します。

**各タスクの構成要素**:

##### Problem Statement（問題定義）
- 「何を作るのか」をビジネス/ユーザーの視点で要約
- 解決すべき課題を簡潔に記載

##### Requirements（要件）
- 実装すべき機能と制約を記載
- プラットフォーム、主要機能、UI/UX要件、非機能要件など

##### Background（背景）
- なぜその技術を選んだかの理由
- データ構造の設計など技術的な意思決定の根拠
- 前提知識の整理

##### Proposed Solution（提案する解決策）
- どのように問題を解決するか
- 実装の優先順位
- 実装アプローチの全体的な戦略

##### Task Breakdown（タスク分解）
実装可能な具体的なステップに分解し、以下を記載：
- **目標**: 何を達成するのか
- **実装ガイダンス**: どう実装するのか
- **Demo**: 何が動作すれば良いと判断できるか

#### 4. 計画の承認と引き継ぎ
実装に移る前に、Planエージェントはユーザーに承認を求めます。

**引き継ぎプロセス**:
1. 実装計画を承認
2. 対話的なプロンプトで実行モードへの切り替えを確認
3. 自動的に以前のエージェントに戻る
4. 完全な計画が実行エージェントに渡される

### 読み取り専用設計

Planエージェントは計画に集中するために読み取り専用モードで動作します。

| 操作 | ステータス | 説明 |
|------|------------|------|
| ファイル読み取り | ✓ 利用可能 | コードベース探索へのフルアクセス |
| コードインテリジェンス | ✓ 利用可能 | コード構造理解のためのLSP操作 |
| 検索（grep, glob） | ✓ 利用可能 | コード探索 |
| Web検索 | ✓ 利用可能 | ドキュメントとリサーチへのアクセス |
| ファイル書き込み | ✗ 利用不可 | ファイルの作成や変更は不可 |
| コマンド実行 | ✗ 利用不可 | 読み取り専用のbashコマンドに制限 |
| MCPツール | ✗ 利用不可 | MCPツールは使用不可 |

**設計思想**:
- 実装の詳細に気を取られることなく計画立案に専念
- 副作用の防止と計画の純粋性を保つ
- 事前のMCPツール活用による情報収集を推奨

### 効果的な使い方

#### 1. 複雑なタスクに使用する
- マルチステップの実装で最も価値を発揮
- 単純なタスクではなく、独立して処理できる複雑なタスクに使用
- 実装前に明確な計画を立てることで効率向上

#### 2. 質問に対して積極的に回答する
- 構造化された質問には思慮深く回答
- 詳細な回答を提供することでより正確な実装計画が作成
- 具体的な仕様をもとに実装させるための妥協しない姿勢

#### 3. 探索を許可する
- Planエージェントが既存のコードベースを分析できるように許可
- 既存のパターンや規約に沿った計画が作成される
- プロジェクトの一貫性を保つ重要な要素

#### 4. 計画をレビューする
- 引き継ぎ前に計画が期待に沿っているか確認
- 必要に応じて調整を依頼
- 仕様を最も理解している人間による手抜きなしのレビュー

#### 5. 必要に応じて反復する
- 計画が明確になるまで継続的に洗練
- Planエージェントは何度でも質問に答えたり計画を調整可能
- フィードバックによる仕様の洗練を優先

## 実用的なユースケース

### API開発の計画立案
```
> /plan RESTful APIで商品管理システムを実装したい
```

**期待される計画内容**:
- エンドポイント設計
- データモデル定義
- 認証・認可方式
- エラーハンドリング戦略
- テスト戦略

### フロントエンド機能の設計
```
> /plan ユーザーダッシュボードのUI/UXを改善したい
```

**期待される計画内容**:
- ユーザビリティ分析
- コンポーネント設計
- 状態管理戦略
- レスポンシブ対応
- アクセシビリティ考慮

### データベース設計の計画
```
> /plan 既存システムのデータベースを最適化したい
```

**期待される計画内容**:
- 現状分析
- パフォーマンス課題の特定
- スキーマ最適化案
- マイグレーション戦略
- 影響範囲の評価

## 注意点と制限事項

### 仕様の永続化
Planエージェントが生成した仕様は専用ファイルとして自動保存されません。

**対処方法**:
```
> 作成した仕様をdocs/spec.mdとして保存して
```

実行モードに切り替える前に上記のように依頼することで仕様を永続化できます。

### MCPツールの制限
計画段階でMCPツールは利用できません。

**対処方法**:
1. 事前にMCPツールを使って情報を収集
2. 収集した情報をもとにPlanモードに移行
3. 必要な外部情報は事前準備として整理

### 完璧な仕様の限界
構造化された質問を通しても完璧な仕様は作成できません。

**重要な原則**:
- 出力された仕様を人間がきちんとレビューする
- 仕様は最初に書いて終わりではなく継続的にフィードバック
- 実装過程での仕様の調整・改善を前提とする

## サブエージェント機能との連携

Planエージェント機能とサブエージェント機能を組み合わせることで、より高度なワークフローを実現できます。

**連携例**:
1. Planエージェントで全体設計を作成
2. 独立したタスクを特定
3. サブエージェントで並列実装を実行

```
> /plan フルスタックWebアプリケーションを開発したい
（計画作成後）
> backendエージェントでAPI実装、frontendエージェントでUI実装を並行して進めて
```

## まとめ

Kiro CLI v1.23.0のPlanエージェント機能は、実装前の計画立案を体系化する革新的な機能です。この機能により：

- **構造化された要件収集**: 曖昧な要求を具体的な仕様に変換
- **包括的なリサーチ**: 既存コードベースと技術トレンドの分析
- **詳細な実装計画**: ステップバイステップのタスク分解
- **スムーズな引き継ぎ**: 実行エージェントへの完全な計画移譲

特にサブエージェント機能と組み合わせることで、計画立案から並列実装まで一貫したワークフローを実現できます。

この機能は、AI駆動開発における「計画→実装」のプロセスを体系化し、より確実で効率的な開発を可能にする重要なアップデートです。
