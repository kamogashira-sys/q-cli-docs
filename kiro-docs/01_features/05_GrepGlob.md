# Kiro CLI Grep/Globツール機能（Grep/Glob Tools）

**出典**: [【Kiro CLI v1.23.0】Grep / Glob ツールのご紹介](https://zenn.dev/aws_japan/articles/ffb6958e1ba0c8) - Zenn記事 by konippi

## 概要

Kiro CLI v1.23.0（2025年12月18日リリース）で追加されたGrep/Globツール機能について詳細に解説します。この機能により、高速なファイル検索を実現する2つの新しいビルトインツールが利用可能になりました。正規表現を使用したコンテンツ検索とGlobパターンを活用したファイル検索により、効率的な開発作業が可能になります。

## 📋 Zenn記事の詳細内容確認

### v1.23.0のGrep/Globツール機能の詳細

#### 主要な機能・特徴

1. **Grep/Globツールの本質**
   - **grep**: 正規表現を使用した高速なコンテンツ検索
   - **glob**: Globパターンを活用した高速なファイル検索
   - カレントディレクトリ内ではデフォルトで信頼され、ユーザー確認なしで実行

2. **shellツールとの違い**
   - `.gitignore`の自動尊重 vs 考慮しない
   - 高速 vs 標準速度
   - カレントディレクトリでデフォルト信頼 vs デフォルト確認が必要

3. **Grepツールの機能**
   - 正規表現を使用したファイル内コンテンツ検索
   - bash の `grep`、`rg`、`ag` コマンドの代替
   - 高速検索と結果表示

4. **Globツールの機能**
   - Globパターンを使用したファイル検索
   - bash の `find` コマンドの代替
   - パターンマッチングによる効率的なファイル発見

5. **設定オプション**
   - `allowedPaths`: プロンプトなしで検索可能なパスのリスト
   - `deniedPaths`: 検索を拒否するパスのリスト
   - `allowReadOnly`: ユーザー確認なしで検索を許可するかどうか

6. **ベストプラクティスと注意点**
   - 具体的な検索パターンの使用
   - 適切なアクセス制御の設定
   - サブエージェントでは利用不可（shellツールを使用）

## Grep/Globツール機能詳細

### 基本概念

v1.23.0では、高速なファイル検索を実現する2つの新しいビルトインツールが追加されました：

- **grep**: 正規表現を使用した高速なコンテンツ検索
- **glob**: Globパターンを活用した高速なファイル検索

> **重要**: これらのツールはカレントディレクトリ内ではデフォルトで信頼され、ユーザーへの確認なしで実行されます。ただし、エージェント設定で`allowedPaths`と`deniedPaths`を指定してアクセス範囲を制御することが可能です。

### shellツールとの違い

従来、Kiro CLIでファイル検索を行う場合、shellツールを使ってbashコマンド（`grep`、`find`など）を実行していました。しかし、新しいGrep/Globツールの追加により、検索対象ファイルの自動フィルタリングや実行速度の向上が実現されました。

| 項目 | Grep/Globツール | shellツール |
|------|------------------|-------------|
| `.gitignore` | 自動的に尊重 | 考慮しない |
| 速度 | 高速 | 標準 |
| カレントディレクトリ | デフォルトで信頼 | デフォルトで確認が必要 |

## Grepツール

Grepツールは、正規表現を使用してファイル内のコンテンツを検索するツールです。bashにおける`grep`や`rg`、`ag`コマンドの代替として利用できます。

### 基本的な使い方

```
> プロジェクト内のすべてのTODO prefixが付いたコメントを探して
```

**実行結果例**:
```
Searching for pattern: TODO (using tool: grep)

 ✓ Found 12 matches across 5 files
 - Completed in 0.34s

> プロジェクト内のTODOコメントを見つけました:

src/utils/helpers.ts:23
  // TODO: エッジケースのエラーハンドリングを追加

src/components/header.tsx:45
  // TODO: モバイルナビゲーションを実装

src/api/routes.ts:12
  // TODO: レート制限を追加
  // TODO: キャッシュを実装

src/services/auth.ts:78
  // TODO: リフレッシュトークンのロジックを追加

...
```

### 設定オプション

Grepツールはエージェント設定ファイルにて検索可能なパスを制御できます。

```json
{
  "toolsSettings": {
    "grep": {
      "allowedPaths": ["~/projects", "./src/**"],
      "deniedPaths": ["/etc", "/var"],
      "allowReadOnly": true
    }
  }
}
```

#### 設定項目

| オプション | 型 | デフォルト | 説明 |
|------------|----|-----------|----|
| `allowedPaths` | string配列 | `[]` | プロンプトなしで検索可能なパスのリスト。Globパターンをサポート |
| `deniedPaths` | string配列 | `[]` | 検索を拒否するパスのリスト。拒否ルールは許可ルールより優先される |
| `allowReadOnly` | boolean | `false` | ユーザーに確認なしで検索を許可するかどうか |

## Globツール

Globツールは、Globパターンを使用してファイルを検索するツールです。bashにおける`find`コマンドの代替として利用できます。

### 基本的な使い方

```
> プロジェクト内のすべてのテストファイルを探して
```

**実行結果例**:
```
Finding files matching pattern: **/*.test.ts (using tool: glob)

 ✓ Found 8 files
 - Completed in 0.12s

> テストファイルは以下の通りです:

src/utils/helpers.test.ts
src/utils/validators.test.ts
src/components/button.test.ts
src/components/header.test.ts
src/services/auth.test.ts
src/services/api.test.ts
src/hooks/useAuth.test.ts
src/hooks/useForm.test.ts
```

### 設定オプション

GlobツールもGrepツールと同様に、エージェント設定ファイルで検索可能なパスを制御できます。

```json
{
  "toolsSettings": {
    "glob": {
      "allowedPaths": ["~/projects", "./src/**"],
      "deniedPaths": ["/etc", "/var"],
      "allowReadOnly": true
    }
  }
}
```

#### 設定項目

| オプション | 型 | デフォルト | 説明 |
|------------|----|-----------|----|
| `allowedPaths` | string配列 | `[]` | プロンプトなしで検索可能なパスのリスト。Globパターンをサポート |
| `deniedPaths` | string配列 | `[]` | 検索を拒否するパスのリスト。拒否ルールは許可ルールより優先される |
| `allowReadOnly` | boolean | `false` | ユーザーに確認なしで検索を許可するかどうか |

## 実用的なユースケース

### コード品質管理
```
> プロジェクト内のすべてのTODOコメントを探して
> console.logが残っているファイルを見つけて
> 未使用のimport文を探して
```

### テスト管理
```
> すべてのテストファイルを探して
> 特定のテストパターンを含むファイルを見つけて
> テストカバレッジが不足している可能性のあるファイルを探して
```

### 設定ファイル管理
```
> 設定ファイル（*.config.js, *.json）を探して
> 環境変数を使用しているファイルを見つけて
> package.jsonファイルをすべて探して
```

### セキュリティ監査
```
> ハードコードされたAPIキーやパスワードを探して
> 機密情報を含む可能性のあるファイルを見つけて
> 認証関連のコードを探して
```

## ベストプラクティス

### 1. 具体的な検索パターンを使用する

曖昧な検索パターンではなく、具体的なパターンを使用することで、より正確な結果が得られます。

**良い例**:
```
> TODO が prefix についているコメントを探して
> エラーハンドリングが必要な箇所を探して
> 非推奨のAPIを使用している箇所を見つけて
```

**悪い例**:
```
> TODO を探して（機能なのかコメントなのか混乱してしまう）
> エラーを探して（エラーメッセージなのかエラーハンドリングなのか不明）
```

### 2. 適切なアクセス制御

`allowedPaths`/`deniedPaths`を活用してアクセス制御を行うことを推奨します。例えば、機密情報を含むディレクトリは`deniedPaths`に追加することで、誤って検索されることを防ぐことができます。

```json
{
  "toolsSettings": {
    "grep": {
      "deniedPaths": [
        "**/.env",
        "**/secrets/**",
        "**/credentials/**",
        "**/node_modules/**",
        "**/.git/**"
      ]
    }
  }
}
```

### 3. プロジェクト固有の設定

プロジェクトの構造に応じて、適切な検索範囲を設定します。

```json
{
  "toolsSettings": {
    "grep": {
      "allowedPaths": [
        "./src/**",
        "./tests/**",
        "./docs/**"
      ],
      "deniedPaths": [
        "./build/**",
        "./dist/**",
        "./coverage/**"
      ]
    },
    "glob": {
      "allowedPaths": [
        "./src/**",
        "./tests/**"
      ]
    }
  }
}
```

## 注意点と制限事項

### サブエージェントでの制限

Grep・Globツールは、サブエージェントでは利用できません。そのため、サブエージェントでファイル検索が必要な場合は、`shell`ツールが利用されます。

**影響**:
- サブエージェント実行時は従来のbashコマンドを使用
- `.gitignore`の自動尊重機能は利用不可
- 検索速度の最適化は適用されない

### パフォーマンス考慮事項

- 大規模なプロジェクトでは検索範囲を適切に制限
- 不要なディレクトリは`deniedPaths`で除外
- 具体的なパターンを使用して検索効率を向上

### セキュリティ考慮事項

- 機密情報を含むディレクトリは`deniedPaths`で保護
- `allowReadOnly`設定は慎重に使用
- 検索結果に機密情報が含まれる可能性を考慮

## トラブルシューティング

### よくある問題と解決方法

#### 検索結果が表示されない
- **原因**: `deniedPaths`で検索対象が除外されている
- **解決**: 設定を確認し、必要に応じて`allowedPaths`を追加

#### 検索が遅い
- **原因**: 検索範囲が広すぎる
- **解決**: `allowedPaths`で検索範囲を限定

#### 権限エラーが発生する
- **原因**: アクセス権限のないディレクトリを検索している
- **解決**: `deniedPaths`に該当ディレクトリを追加

## まとめ

Kiro CLI v1.23.0のGrep/Globツール機能は、高速で一貫性のあるファイル検索を実現する革新的な機能です。この機能により：

- **高速検索**: 従来のshellツールより高速な検索処理
- **自動フィルタリング**: `.gitignore`の自動尊重による効率的な検索
- **柔軟な制御**: `allowedPaths`/`deniedPaths`による細かなアクセス制御
- **セキュリティ**: 機密情報の保護と安全な検索環境

主なポイント：
- **Grepツール**: 正規表現を使用した高速なコンテンツ検索
- **Globツール**: Globパターンを使用した高速なファイル検索
- **`.gitignore`の自動尊重**: 不要なファイルを自動的に除外
- **きめ細かなアクセス制御**: 設定により検索可能なパスを制限可能

この機能は、AI駆動開発における効率的なコード探索と管理を実現し、開発者の生産性を大幅に向上させる重要なアップデートです。
