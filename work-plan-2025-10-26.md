# 作業計画書 - 2025-10-26

## 📋 作業概要

昨日（2025-10-25）追加した大量のドキュメント（約50,000文字）の品質保証とメンテナンス作業を実施する。
**重点**: 存在しないコマンドの記載を根絶し、実行可能な正確なドキュメントを確保する。

---

## 🎯 作業1: 新規追加ドキュメントのレビュー

### 1.1 ファイル仕様書6件の内容確認

#### 対象ファイル
1. `docs/01_for-users/10_file-specifications/02_agent-configuration.md`
2. `docs/01_for-users/10_file-specifications/03_mcp-configuration.md`
3. `docs/01_for-users/10_file-specifications/04_global-settings.md`
4. `docs/01_for-users/10_file-specifications/05_checkpoint.md`
5. `docs/01_for-users/10_file-specifications/06_conversation_state.md`
6. `docs/01_for-users/10_file-specifications/07_message_structures.md`

#### 検証項目

##### A. コマンド構文の正確性検証

**実在するコマンド（使用可能）**
```bash
# Agent管理
q agent list
q agent create
q agent edit --name <NAME>
q agent validate
q agent migrate
q agent set-default

# 設定管理
q settings                    # キーと値を指定して設定
q settings <key> <value>      # 設定値の変更
q settings <key>              # 設定値の確認
q settings --delete <key>     # 設定の削除
q settings open               # 設定ファイルを開く
q settings list               # 設定一覧表示

# MCP管理
q mcp add
q mcp remove
q mcp list
q mcp import
q mcp status

# チャット
q chat
q chat --resume
q chat --agent <AGENT>
q chat --model <MODEL>
q chat --trust-all-tools
q chat --trust-tools <TOOL_NAMES>
q chat --no-interactive

# その他
q doctor
q whoami
```

**存在しないコマンド（修正が必要）**
```bash
# これらは存在しない - ドキュメントから削除または修正が必要
q agent use              # → q agent set-default または q chat --agent
q knowledge              # → 存在しない（設定は q settings chat.enableKnowledge）
q settings edit          # → q settings open
q settings show          # → q settings list
q settings set           # → q settings <key> <value>
q settings all           # → q settings list
```

##### B. 検証手順

```bash
# 1. 各ファイルから全てのコマンド例を抽出
cd /home/katoh/projects/q-cli-docs
for file in docs/01_for-users/10_file-specifications/*.md; do
  echo "=== $file ==="
  grep -n "^q " "$file" | grep -v "^#"
done > /tmp/commands_in_specs.txt

# 2. 存在しないコマンドを検索
grep -E "(q agent use|q knowledge|q settings edit|q settings show|q settings set|q settings all)" /tmp/commands_in_specs.txt

# 3. 各コマンドの文脈を確認
grep -B 2 -A 2 "q agent use" docs/01_for-users/10_file-specifications/*.md
```

##### C. 修正方針

| 誤ったコマンド | 正しいコマンド | 修正方法 |
|---------------|---------------|---------|
| `q agent use <name>` | `q agent set-default` または `q chat --agent <name>` | 文脈に応じて適切なコマンドに置換 |
| `q knowledge add` | 存在しない | 説明文を修正（設定は`q settings chat.enableKnowledge true`） |
| `q settings edit` | `q settings open` | 直接置換 |
| `q settings show` | `q settings list` | 直接置換 |
| `q settings set <key> <value>` | `q settings <key> <value>` | `set`を削除 |
| `q settings all` | `q settings list` | 直接置換 |

#### 実施タスク

- [ ] 1.1.1: 全ファイルからコマンド例を抽出（上記スクリプト実行）
- [ ] 1.1.2: 存在しないコマンドをリストアップ
- [ ] 1.1.3: 各コマンドの文脈を確認し修正方針を決定
- [ ] 1.1.4: 修正を実施
- [ ] 1.1.5: 修正後の動作確認（可能な範囲で実行テスト）

---

### 1.2 ワークフロー自動化ガイドの実用性検証

#### 対象ファイル
- `docs/01_for-users/08_guides/09_workflow-automation.md`

#### 検証項目

##### A. Agent Hooks実行可能性の検証

**検証対象**
1. `agentSpawn` フックの動作確認
2. `beforePrompt` フックの動作確認
3. `afterResponse` フックの動作確認
4. 環境変数展開の動作確認

**検証方法**
```bash
# 1. テスト用Agentを作成
mkdir -p /tmp/test-agent
cat > /tmp/test-agent/test-hook.json << 'EOF'
{
  "name": "test-hook",
  "hooks": {
    "agentSpawn": [
      {
        "command": "echo 'Hook test: agentSpawn executed'"
      }
    ]
  }
}
EOF

# 2. Agentを実行してフックが動作するか確認
cd /tmp/test-agent
q chat --agent test-hook "Hello"

# 3. 出力にフックのメッセージが含まれるか確認
```

##### B. コマンド例の実行可能性検証

**ドキュメント内のコマンド例を全て抽出**
```bash
cd /home/katoh/projects/q-cli-docs
grep -n "^q " docs/01_for-users/08_guides/09_workflow-automation.md
```

**検証結果の記録**
- 実行可能: ✅
- 実行不可: ❌（理由を記載）
- 要修正: ⚠️（修正内容を記載）

#### 実施タスク

- [ ] 1.2.1: ワークフロー自動化ガイドからコマンド例を抽出
- [ ] 1.2.2: 各コマンドの構文を検証
- [ ] 1.2.3: Agent Hooksのサンプルを実際に作成して動作確認
- [ ] 1.2.4: 問題があれば修正
- [ ] 1.2.5: 実用性の評価コメントを追加

---

## 🔗 作業2: リンク整合性の最終確認

### 2.1 昨日修正したリンクの動作確認

#### 対象ファイル
- `docs/01_for-users/07_reference/10_error-messages.md` (9件修正)
- `docs/01_for-users/README.md` (1件修正)
- `docs/02_for-developers/01_contributing/README.md` (2件削除)

#### 検証方法

```bash
cd /home/katoh/projects/q-cli-docs

# 1. 修正されたリンクを抽出
git diff 01f5c38^..01f5c38 | grep -E "^\+.*\[.*\]\(.*\)" | sed 's/^+//'

# 2. リンク先ファイルの存在確認
# エラーメッセージドキュメントのリンクを確認
grep -o '\](docs/[^)]*\.md)' docs/01_for-users/07_reference/10_error-messages.md | \
  sed 's/](//;s/)//' | \
  while read link; do
    if [ ! -f "$link" ]; then
      echo "❌ リンク切れ: $link"
    else
      echo "✅ OK: $link"
    fi
  done

# 3. アンカーリンクの確認（見出しが存在するか）
# 例: [チャット機能](../02_features/01_chat.md#基本的な使い方)
# → 01_chat.mdに「基本的な使い方」という見出しが存在するか確認
```

#### 実施タスク

- [ ] 2.1.1: 修正されたリンクを全て抽出
- [ ] 2.1.2: リンク先ファイルの存在確認スクリプト実行
- [ ] 2.1.3: アンカーリンクの見出し存在確認
- [ ] 2.1.4: リンク切れがあれば修正
- [ ] 2.1.5: 修正結果をコミット

---

### 2.2 新規追加ドキュメントからのリンク確認

#### 対象ファイル（昨日追加された全ドキュメント）

```
docs/01_for-users/02_features/01_chat.md
docs/01_for-users/02_features/02_agents.md
docs/01_for-users/02_features/07_experimental.md
docs/01_for-users/03_configuration/03_agent-configuration.md
docs/01_for-users/03_configuration/04_mcp-configuration.md
docs/01_for-users/04_best-practices/05_agent-hooks-comparison.md
docs/01_for-users/07_reference/10_error-messages.md
docs/01_for-users/08_guides/01_essence.md
docs/01_for-users/08_guides/09_workflow-automation.md
docs/01_for-users/10_file-specifications/02_agent-configuration.md
docs/01_for-users/10_file-specifications/03_mcp-configuration.md
docs/01_for-users/10_file-specifications/04_global-settings.md
docs/01_for-users/10_file-specifications/05_checkpoint.md
docs/01_for-users/10_file-specifications/06_conversation_state.md
docs/01_for-users/10_file-specifications/07_message_structures.md
docs/02_for-developers/01_contributing/05_error-management-overview.md
docs/02_for-developers/01_contributing/06_adding-error-messages.md
```

#### 検証スクリプト

```bash
cd /home/katoh/projects/q-cli-docs

# 新規追加ドキュメントからのリンクを全て抽出して検証
cat > /tmp/check_new_doc_links.sh << 'SCRIPT'
#!/bin/bash

FILES=(
  "docs/01_for-users/02_features/01_chat.md"
  "docs/01_for-users/02_features/02_agents.md"
  "docs/01_for-users/02_features/07_experimental.md"
  "docs/01_for-users/03_configuration/03_agent-configuration.md"
  "docs/01_for-users/03_configuration/04_mcp-configuration.md"
  "docs/01_for-users/04_best-practices/05_agent-hooks-comparison.md"
  "docs/01_for-users/07_reference/10_error-messages.md"
  "docs/01_for-users/08_guides/01_essence.md"
  "docs/01_for-users/08_guides/09_workflow-automation.md"
  "docs/01_for-users/10_file-specifications/02_agent-configuration.md"
  "docs/01_for-users/10_file-specifications/03_mcp-configuration.md"
  "docs/01_for-users/10_file-specifications/04_global-settings.md"
  "docs/01_for-users/10_file-specifications/05_checkpoint.md"
  "docs/01_for-users/10_file-specifications/06_conversation_state.md"
  "docs/01_for-users/10_file-specifications/07_message_structures.md"
  "docs/02_for-developers/01_contributing/05_error-management-overview.md"
  "docs/02_for-developers/01_contributing/06_adding-error-messages.md"
)

for file in "${FILES[@]}"; do
  echo "=== Checking: $file ==="
  
  # 相対リンクを抽出（../で始まるもの）
  grep -o '\](\.\.\/[^)]*\.md[^)]*)' "$file" | \
    sed 's/](\.\.\///' | sed 's/)//' | \
    while read link; do
      # ファイルパスを計算
      dir=$(dirname "$file")
      target="$dir/../$link"
      target=$(realpath -m "$target" 2>/dev/null || echo "$target")
      
      # アンカーを除去
      file_only=$(echo "$link" | cut -d'#' -f1)
      target_file="$dir/../$file_only"
      target_file=$(realpath -m "$target_file" 2>/dev/null || echo "$target_file")
      
      if [ ! -f "$target_file" ]; then
        echo "  ❌ リンク切れ: $link → $target_file"
      fi
    done
done
SCRIPT

chmod +x /tmp/check_new_doc_links.sh
/tmp/check_new_doc_links.sh
```

#### 実施タスク

- [ ] 2.2.1: リンク検証スクリプトを実行
- [ ] 2.2.2: リンク切れをリストアップ
- [ ] 2.2.3: 各リンク切れの原因を特定
- [ ] 2.2.4: リンクを修正
- [ ] 2.2.5: 再度検証スクリプトを実行して確認

---

## ✅ 作業3: v1.19.0関連の完全性チェック

### 3.1 マイグレーションガイドの実践性確認

#### 対象ファイル
- `docs/03_for-community/01_updates/04_migration-guides.md`

#### 検証項目

##### A. コマンド構文の検証

**ドキュメント内の全コマンドを抽出**
```bash
cd /home/katoh/projects/q-cli-docs
grep -n "^q " docs/03_for-community/01_updates/04_migration-guides.md | grep -v "^#"
```

**検証対象コマンド**
```bash
# 以下のコマンドが実在するか確認
q chat
q chat --resume
q chat --resume "続きを教えて"
q agent list
q agent edit my-agent
q agent validate
q doctor
q settings chat.enableKnowledge
```

**存在しないコマンドの検出**
```bash
# マイグレーションガイドから存在しないコマンドを検索
grep -E "(q agent use|q knowledge|q settings edit|q settings show|q settings set)" \
  docs/03_for-community/01_updates/04_migration-guides.md
```

##### B. 移行手順の実行可能性検証

**必須移行手順の検証**
1. `--resume`動作変更への対応
2. `bash` tool権限設定の確認
3. Agent設定の検証

**検証方法**
```bash
# 1. --resume動作の確認
cd /tmp/test-resume
q chat "テスト1"
# 終了後
q chat "テスト2"  # 新しい会話として開始されるか確認

# 2. bash tool権限の確認
# Agent設定に以下が含まれているか確認
grep -r "execute_bash" ~/.aws/amazonq/agents/*.json .amazonq/agents/*.json 2>/dev/null

# 3. Agent設定の検証
q agent validate
```

#### 実施タスク

- [ ] 3.1.1: マイグレーションガイドから全コマンドを抽出
- [ ] 3.1.2: 存在しないコマンドを検出
- [ ] 3.1.3: 各コマンドを正しい構文に修正
- [ ] 3.1.4: 移行手順の実行可能性を検証
- [ ] 3.1.5: 不明瞭な説明を改善

---

### 3.2 roadmapの完了項目と実際のリリースノートの整合性

#### 対象ファイル
- `docs/03_for-community/01_updates/02_roadmap.md`
- `docs/03_for-community/01_updates/03_version-history-v1.13-latest.md`

#### 検証項目

##### A. v1.19.0完了機能の整合性確認

**roadmapに記載された完了機能（9項目）**
1. Knowledge PDF対応
2. 画像ペースト対応
3. OAuth redirect URI設定
4. HTTP MCP headers環境変数
5. bash tool deny_by_default
6. builtin tool namespace
7. settings list表示改善
8. /logdump --mcp対応
9. --resume動作変更

**検証方法**
```bash
cd /home/katoh/projects/q-cli-docs

# 1. roadmapの完了項目を抽出
grep -A 50 "v1.19.0で完了した機能" docs/03_for-community/01_updates/02_roadmap.md

# 2. version-historyのv1.19.0セクションを抽出
grep -A 100 "## v1.19.0" docs/03_for-community/01_updates/03_version-history-v1.13-latest.md

# 3. 両者を比較して整合性を確認
```

##### B. 機能説明の一貫性確認

**確認ポイント**
- roadmapの説明とversion-historyの説明が一致しているか
- 機能の実装状況が正確に反映されているか
- リンク先が正しいか

**検証スクリプト**
```bash
cd /home/katoh/projects/q-cli-docs

# roadmapとversion-historyの両方に記載されている機能を抽出
cat > /tmp/compare_roadmap_version.sh << 'SCRIPT'
#!/bin/bash

echo "=== roadmap v1.19.0完了機能 ==="
grep -A 50 "v1.19.0で完了した機能" docs/03_for-community/01_updates/02_roadmap.md | \
  grep "^-" | head -10

echo ""
echo "=== version-history v1.19.0機能 ==="
grep -A 100 "## v1.19.0" docs/03_for-community/01_updates/03_version-history-v1.13-latest.md | \
  grep "^-" | head -20

echo ""
echo "=== 差分確認が必要 ==="
echo "上記2つのリストを目視で比較し、整合性を確認してください"
SCRIPT

chmod +x /tmp/compare_roadmap_version.sh
/tmp/compare_roadmap_version.sh
```

#### 実施タスク

- [ ] 3.2.1: roadmapとversion-historyの比較スクリプト実行
- [ ] 3.2.2: 完了機能リストの整合性確認
- [ ] 3.2.3: 機能説明の一貫性確認
- [ ] 3.2.4: 不整合があれば修正
- [ ] 3.2.5: リンク先の確認

---

## 📊 作業完了基準

### 品質基準

1. **コマンド正確性**: 100%（存在しないコマンドが0件）
2. **リンク整合性**: 100%（リンク切れが0件）
3. **実行可能性**: 全てのコマンド例が実行可能
4. **整合性**: roadmapとversion-historyが完全に一致

### 完了チェックリスト

- [ ] 全ての存在しないコマンドを修正
- [ ] 全てのリンク切れを修正
- [ ] 全てのコマンド例を検証
- [ ] roadmapとversion-historyの整合性確認
- [ ] 修正内容をコミット
- [ ] 作業完了報告書を作成

---

## 🔧 使用ツール

### 検証ツール
- `grep`: パターン検索
- `git diff`: 変更差分確認
- `realpath`: パス解決
- `q --help-all`: コマンド一覧確認
- `q <subcommand> --help`: サブコマンドヘルプ確認

### 実行環境
- OS: Linux
- Shell: bash
- 作業ディレクトリ: `/home/katoh/projects/q-cli-docs`

---

## 📝 作業ログ

### 作業開始
- 日時: 2025-10-26 06:13
- 担当: Amazon Q Developer CLI

### 作業記録
（作業進行中に随時更新）

---

## ⚠️ 注意事項

1. **コマンド実行前の確認**: 全てのコマンドは`q --help`で存在を確認してから記載する
2. **リンク確認の徹底**: 相対パスの計算ミスに注意
3. **バックアップ**: 大規模な修正前にブランチを作成
4. **段階的コミット**: 作業1、作業2、作業3ごとにコミット

---

*この作業計画書は、実在するコマンドのみを使用し、実行可能性を最優先に設計されています。*
