[ホーム](../README.md) > [Meta](README.md) > 作業原則（詳細）

---

# 作業原則（詳細）

本ドキュメントは、[どうやって品質を保っているか](03_how-we-ensure-quality.md)の詳細版です。

**対象読者**: コントリビューター、レビュアー

**目的**: 品質を保つための具体的な行動指針を提供

---

## 9つの作業原則

本サイトでは、**9つの作業原則**で品質を保証しています。

### 優先順位

- **P1: 必須原則（3原則）** - すべての作業で厳守
- **P2: 重要原則（3原則）** - 技術仕様の作成・修正で実施
- **P3: 推奨原則（3原則）** - 大規模な変更で実施

---

## P1: 必須原則（3原則）

### 原則1: 実装を確認する

**禁止事項**:
- ❌ 推測で書く（「たぶん」「おそらく」「だと思う」）
- ❌ ドキュメントだけを信じる
- ❌ AI生成を盲信する

**必須事項**:
- ✅ ソースコードで実装を確認する
- ✅ 参照したソースファイルとバージョンを記録する
- ✅ 実装と異なる記述を発見したら即座に修正する

**具体的な基準**:

1. **ソースコード確認の範囲**:
   - 設定項目: スキーマファイル、定数定義、構造体定義
   - コマンド: CLI定義、サブコマンド実装
   - 機能: エントリーポイントから呼び出される関数（深さ2まで）
   - パス: ディレクトリ定数、パス生成ロジック

2. **確認が必要な記述**:
   - 技術仕様（設定項目、コマンド、パス、環境変数）
   - 動作説明（機能、制約、制限事項）
   - 使用例（コマンド例、設定例）

3. **確認が不要な記述**:
   - 一般常識（「Q CLIはAWSが提供するツール」など）
   - 概念説明（「AIとは」など）
   - 外部サービスの説明（「GitHubとは」など）

4. **記録形式**:
   ```markdown
   <!-- 実装確認済み -->
   - ソースファイル: crates/chat-cli/src/util/directories.rs
   - バージョン: v1.19.3
   - 確認日: 2025-11-02
   ```

**検証方法**:
- [ ] ソースコードを確認した
- [ ] 参照したソースファイルとバージョンを記録した
- [ ] 実装と記述が一致することを確認した

---

### 原則2: 動作を確認する

**禁止事項**:
- ❌ 「動くはず」という推測
- ❌ コマンド例を実行せずに記載
- ❌ URLの実在性を確認せずに記載

**必須事項**:
- ✅ コマンド例を実際に実行する
- ✅ URLの実在性を確認する
- ✅ 実行結果を記録する

**具体的な基準**:

1. **コマンド実行確認のサンプリング基準**:
   - 各セクションから最低1つのコマンド例を実行
   - 重要なコマンド（インストール、設定、起動）はすべて実行
   - 環境依存のコマンドは複数環境で実行

2. **URL確認の方法**:
   - 自動化ツール使用: `curl -I <URL>` または リンクチェッカー
   - HTTP 200/301/302 を正常とする
   - HTTP 403/404/500 はエラーとする
   - 確認頻度: ドキュメント作成時、月次レビュー時

3. **実行結果の記録形式**:
   ```markdown
   <!-- 動作確認済み -->
   \`\`\`bash
   $ q chat "hello"
   # 実行結果: 正常に応答
   # 確認日: 2025-11-02
   # 環境: Ubuntu 22.04, Q CLI v1.19.3
   \`\`\`
   ```

**検証方法**:
- [ ] コマンド例を実行した（サンプリング基準に従う）
- [ ] URLの実在性を確認した
- [ ] 実行結果を記録した

**自動化**:
- ✅ ツール実装済み: `check-urls.sh`, `check-commands.sh`

---

### 原則3: 品質を最優先する

**禁止事項**:
- ❌ 時間を理由に品質を下げる
- ❌ 「だいたいOK」で妥協する
- ❌ 簡略化を理由に検証を省略する

**必須事項**:
- ✅ 品質基準を満たすまで完了としない
- ✅ すべての検証を実施する
- ✅ 妥協しない

**具体的な基準**:

1. **品質基準**:
   - 正確性: 実装と一致している
   - 完全性: 必要な情報がすべて含まれている
   - 一貫性: ドキュメント全体で矛盾がない
   - 実行可能性: コマンド例が実際に動作する
   - 最新性: 最新バージョンの情報である

2. **完了の定義**:
   - すべての品質基準を満たしている
   - すべての検証項目をクリアしている
   - レビューで指摘事項がない

3. **妥協しない基準**:
   - 「時間がない」は理由にならない
   - 「だいたい合っている」は不合格
   - 「後で修正する」は認めない

**検証方法**:
- [ ] すべての品質基準を満たしている
- [ ] すべての検証項目をクリアしている
- [ ] 妥協していない

---

## P2: 重要原則（3原則）

### 原則4: 影響範囲と完全性を確認する

**禁止事項**:
- ❌ 修正箇所だけを確認する
- ❌ 影響範囲を推測する
- ❌ 確認漏れを放置する

**必須事項**:
- ✅ 修正の影響範囲をすべて確認する
- ✅ 影響範囲チェックリストを使用する
- ✅ 完全性を確認する

**具体的な基準**:

1. **影響範囲の定義**:
   - 直接的な影響: 修正したファイル内の他の箇所
   - 間接的な影響: 同じ情報を参照している他のファイル（grep検索）
   - 関連する影響: 同じキーワードを含むファイル、同じカテゴリのファイル

2. **影響範囲チェックリスト**:
   ```markdown
   - [ ] 修正したファイル内の他の箇所を確認
   - [ ] 同じ情報を参照している他のファイルを確認（grep検索）
   - [ ] 同じキーワードを含むファイルを確認
   - [ ] 同じカテゴリのファイルを確認
   - [ ] リンク切れがないか確認
   - [ ] 一貫性が保たれているか確認
   ```

3. **完全性の確認**:
   - すべての必須項目が含まれているか
   - 説明が十分か
   - 例が適切か

**検証方法**:
- [ ] 影響範囲チェックリストをすべて確認した
- [ ] 完全性を確認した
- [ ] 確認漏れがない

**自動化**:
- ✅ ツール実装済み: `check-impact.sh`, `check-completeness.py`

---

### 原則5: クロスチェックを実施する

**禁止事項**:
- ❌ 単一情報源だけを信じる
- ❌ 情報源間の矛盾を放置する
- ❌ 優先順位を無視する

**必須事項**:
- ✅ 複数の情報源をクロスチェックする
- ✅ 情報源の優先順位に従う
- ✅ 矛盾を発見したら調査する

**具体的な基準**:

1. **情報源の数**:
   - 技術仕様: 最低2つ（ソースコード + 実行結果）
   - 動作説明: 最低2つ（ソースコード + ドキュメント）
   - 一般情報: 1つでも可

2. **情報源の優先順位**:
   1. ソースコード（最優先）
   2. 実行結果
   3. 公式ドキュメント
   4. 過去の調査結果
   5. コミュニティ情報

3. **矛盾の対応**:
   - 優先順位の高い情報源を採用
   - 矛盾の原因を調査
   - 調査結果を記録

**検証方法**:
- [ ] 複数の情報源をクロスチェックした
- [ ] 情報源の優先順位に従った
- [ ] 矛盾がないことを確認した

---

### 原則6: 一貫性を確認する

**禁止事項**:
- ❌ ドキュメント内の矛盾を放置する
- ❌ 同じ情報が複数箇所にあることを無視する
- ❌ 表記揺れを放置する

**必須事項**:
- ✅ ドキュメント全体の一貫性を確認する
- ✅ 同じ情報が複数箇所にある場合、すべて一致することを確認する
- ✅ 表記揺れを統一する

**具体的な基準**:

1. **一貫性の確認項目**:
   - 用語の統一（例: Agent vs agent）
   - パスの統一（例: `~/.aws/amazonq/cli-agents`）
   - コマンドの統一（例: `q chat` vs `q-chat`）
   - バージョンの統一（例: v1.19.3 vs 1.19.3）

2. **確認方法**:
   - 自動化ツール使用: `make check-consistency` コマンド
   - 手動確認: 重要な用語、パス、コマンドを検索

3. **表記揺れの統一基準**:
   - 公式ドキュメントの表記に従う
   - ソースコードの表記に従う
   - プロジェクト内の表記ガイドに従う

**検証方法**:
- [ ] 一貫性を確認した
- [ ] 同じ情報が複数箇所にある場合、すべて一致することを確認した
- [ ] 表記揺れを統一した

**自動化**:
- ✅ ツール実装済み: `check-consistency.sh`

---

## P3: 推奨原則（3原則）

### 原則7: 検証工程を組み込む

**禁止事項**:
- ❌ 検証なしで次の工程に進む
- ❌ 検証工程を省略する
- ❌ 検証を「後で」に回す

**必須事項**:
- ✅ すべての作業に検証工程を含める
- ✅ 品質ゲートを設置する
- ✅ 検証工程を作業計画に明記する

**具体的な基準**:

1. **検証工程が必要な作業**:
   - 新規ドキュメント作成
   - 既存ドキュメント修正（技術仕様、コマンド例、設定例）
   - 大規模な変更（複数ファイル、複数セクション）

2. **検証工程が不要な作業**:
   - 誤字修正（技術用語以外）
   - フォーマット修正（インデント、改行）
   - リンク修正（URL変更なし）

3. **品質ゲート**:
   - 作業完了時: すべての検証項目をクリア
   - レビュー時: レビュー指摘事項をすべて対応
   - リリース前: 最終品質チェックをクリア

4. **作業計画のテンプレート**:
   ```markdown
   ## 作業計画
   
   ### 作業内容
   - [ ] 実装確認
   - [ ] 動作確認
   - [ ] 影響範囲確認
   - [ ] クロスチェック
   - [ ] 一貫性確認
   
   ### 検証工程
   - [ ] 原則1-6の検証項目をすべてクリア
   - [ ] 品質ゲート通過
   ```

**検証方法**:
- [ ] 検証工程を作業計画に明記した
- [ ] 品質ゲートを設置した
- [ ] 検証工程を実施した

---

### 原則8: 自動化を優先する

**禁止事項**:
- ❌ 人間の目視だけに依存する
- ❌ 自動化できるのに手動で実施する
- ❌ 自動化ツールを使用しない

**必須事項**:
- ✅ 自動化ツールを優先的に使用する
- ✅ 自動化できない場合のみ手動で実施する
- ✅ 検証結果を自動記録する

**具体的な基準**:

1. **自動化すべき項目**:
   - URL実在性確認
   - コマンド構文チェック
   - 一貫性チェック
   - リンク切れチェック
   - 表記揺れチェック

2. **使用すべきツール**:
   - URL確認: `make check-urls`（内部: curl, linkchecker）
   - コマンド構文: `make check-commands`（内部: shellcheck, 正規表現）
   - 一貫性: `make check-consistency`（内部: grep, diff）
   - 影響範囲: `make check-impact`（内部: git grep, 依存関係分析）
   - 完全性: `make check-completeness`（内部: チェックリスト照合）

3. **ツールがない場合の対応**:
   1. 既存ツールで代替できないか検討
   2. 手動実施し、作業記録に詳細を記載
   3. 将来の自動化のため、手順を文書化

4. **検証結果の自動記録**:
   - ツール実行ログを保存
   - 検証日時を記録
   - 検証結果（合格/不合格）を記録

**検証方法**:
- [ ] 自動化ツールを使用した
- [ ] 検証結果を自動記録した
- [ ] 手動実施は最小限にした

**自動化ツール一覧**:
```bash
# すべての検証を実行
make check-all

# 個別の検証
check-urls.sh          # URL実在性確認
check-commands.sh      # コマンド構文チェック
check-consistency.sh   # 一貫性チェック
check-impact.sh        # 影響範囲分析
check-completeness.py  # 完全性チェック
```

---

### 原則9: 品質ゲートと記録

**禁止事項**:
- ❌ 検証結果を記録しない
- ❌ 品質ゲート通過を確認しない
- ❌ 検証ログを保存しない

**必須事項**:
- ✅ 品質ゲート通過を確認する
- ✅ 検証結果を記録する
- ✅ 検証ログを保存する

**具体的な基準**:

1. **品質ゲートの基準**:
   - P1原則（必須）: すべてクリア必須
   - P2原則（重要）: すべてクリア推奨
   - P3原則（推奨）: 可能な限りクリア

2. **検証結果の記録形式（簡略版）**:
   ```markdown
   ## 検証結果 (2025-11-02 17:06 JST)
   
   P1: ✅ すべてクリア
   P2: ✅ すべてクリア
   P3: ✅ すべてクリア
   
   品質ゲート: ✅ 通過
   
   詳細: [検証ログ](202511021706_verification_log.md)
   ```

3. **検証ログの保存場所**:
   - 作業記録ディレクトリ: `/home/katoh/work_records/YYYYMMDD/`
   - ファイル名: `YYYYMMDDHHMM_verification_log.md`

**検証方法**:
- [ ] 品質ゲート通過を確認した
- [ ] 検証結果を記録した
- [ ] 検証ログを保存した

---

## 実践ガイド

### 新規ドキュメント作成時

1. **作業計画作成**（原則7）
   - 検証工程を明記
   - 品質ゲートを設置

2. **実装確認**（原則1）
   - ソースコードを確認
   - 参照したソースファイルとバージョンを記録

3. **動作確認**（原則2）
   - コマンド例を実行
   - URLの実在性を確認
   - 実行結果を記録

4. **影響範囲確認**（原則4）
   - 影響範囲チェックリストを使用
   - 完全性を確認

5. **クロスチェック**（原則5）
   - 複数の情報源を確認
   - 矛盾がないか確認

6. **一貫性確認**（原則6）
   - 自動化ツールを使用
   - 表記揺れを統一

7. **品質ゲート通過**（原則9）
   - すべての検証項目をクリア
   - 検証結果を記録

### 既存ドキュメント修正時

1. **影響範囲確認**（原則4）
   - 修正の影響範囲を特定
   - 影響範囲チェックリストを使用

2. **実装確認**（原則1）
   - 修正内容が実装と一致するか確認

3. **動作確認**（原則2）
   - 修正したコマンド例を実行

4. **一貫性確認**（原則6）
   - 自動化ツールを使用

5. **品質ゲート通過**（原則9）
   - P1原則をすべてクリア

---

## 関連ドキュメント

- [どうやって品質を保っているか](03_how-we-ensure-quality.md) - 概要
- [自動化ツール](05_automation-tools.md) - ツールの詳細
- [手動チェック](06_manual-checks.md) - チェックリストの詳細

---

**最終更新**: 2025-11-02
