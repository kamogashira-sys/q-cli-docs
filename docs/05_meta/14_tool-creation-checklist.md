[ホーム](../README.md) > [Meta](README.md) > ツール作成チェックリスト

---

# ツール作成チェックリスト

**目的**: ツール実装時の品質を保証し、検証不足による不具合を防止する

---

## 🚀 推奨: テンプレートを使用

新規ツール作成時は**テンプレートの使用を強く推奨**します：

```bash
./tools/create-check-tool.sh check-your-tool "Check for your issue"
```

**メリット**:
- ✅ ベストプラクティスが組み込まれている
- ✅ テストが自動生成される
- ✅ 5分で作成可能
- ✅ 実装ミスを防止

詳細: [tools/templates/README.md](../../tools/templates/README.md)

---

## 📋 実装前

- [ ] **テンプレートから作成**（推奨）
  - `./tools/create-check-tool.sh` を使用
  - ツールとテストが同時に生成される

- [ ] **目的を明確化**
  - 何を検出するツールか
  - どのような問題を解決するか
  - 既存ツールとの重複はないか

- [ ] **既知のバグを特定**
  - テストケースとなるバグファイルを準備
  - 正常ケースのサンプルも準備
  - 検出すべきパターンを明確化

- [ ] **実装方法を選定**
  - シンプルさを優先（grep < awk < Python）
  - デバッグしやすい方法を選択
  - 保守性を考慮

---

## 🔧 実装中

- [ ] **出力を標準出力に表示**
  - リダイレクトで結果を捨てない
  - 検出内容を明示的に表示
  - ファイル名と行番号を含める

- [ ] **エラーメッセージを明示**
  - 何が問題かを明確に表示
  - 修正方法のヒントを提供
  - 一貫したフォーマット

- [ ] **終了コードを適切に設定**
  - 問題検出時: exit 1
  - 問題なし: exit 0
  - エラー発生時: exit 2

---

## ✅ 実装後（必須）

### 異常系テスト（最重要）

- [ ] **既知のバグでテスト**
  ```bash
  # 既知のバグファイルを作成
  cat > /tmp/test-bug.md << 'EOF'
  [既知のバグ内容]
  EOF
  
  # ツールを実行
  ./tools/check-tool.sh /tmp
  
  # 検出されることを確認
  # ❌ test-bug.md:X-Y: [問題内容]
  ```

- [ ] **検出結果を目視確認**
  - 標準出力に結果が表示されるか
  - ファイル名と行番号が正しいか
  - 問題内容が明確か

- [ ] **終了コードを確認**
  ```bash
  ./tools/check-tool.sh /tmp
  echo $?  # 1 が返ることを確認
  ```

### 正常系テスト

- [ ] **正常ケースでテスト**
  ```bash
  # 正常なファイルを作成
  cat > /tmp/test-normal.md << 'EOF'
  [正常な内容]
  EOF
  
  # ツールを実行
  ./tools/check-tool.sh /tmp
  
  # 問題なしと表示されることを確認
  # ✅ No issues found
  ```

- [ ] **誤検出がないか確認**
  - 正常なファイルで警告が出ないか
  - 意図しないパターンを検出していないか

### 網羅性テスト

- [ ] **検出漏れがないか確認**
  - 複数の既知バグで全て検出できるか
  - エッジケースも検出できるか
  - 複数ファイルで正しく動作するか

---

## 🔗 統合前

- [ ] **pre-commit/pre-pushフックに追加**
  - `.git/hooks/pre-commit` に追加
  - `.git/hooks/pre-push` に追加
  - フック動作を確認

- [ ] **ドキュメント更新**
  - `docs/05_meta/05_automation-tools.md` に追加
  - `docs/05_meta/09_daily-workflow.md` に追加
  - 使用方法を記載

- [ ] **使用方法を記載**
  - 実行コマンド
  - 検出内容
  - 出力例

---

## ⚠️ 重要な注意事項

### やってはいけないこと

❌ **リダイレクトで結果を捨てる**
```bash
# ダメな例
if grep -Pzo 'pattern' "$file" > /dev/null 2>&1; then
    # 結果が失われる
fi
```

❌ **終了コードだけで判断**
```bash
# ダメな例
if some_command; then
    echo "✅ OK"
fi
# → 何を検出したか不明
```

❌ **テストせずに統合**
```bash
# ダメな例
$ ./new-tool.sh
✅ チェック完了
$ git add tools/new-tool.sh
$ git commit
# → 実際には何も検出していない可能性
```

### 必ずやること

✅ **既知のバグでテスト**
```bash
# 良い例
$ echo -e "---\n\n---" > /tmp/bug.md
$ ./tools/check-tool.sh /tmp
❌ /tmp/bug.md:1-3: Consecutive separators
# → 正しく検出できることを確認
```

✅ **出力を確認**
```bash
# 良い例
$ ./tools/check-tool.sh docs/
❌ docs/file1.md:10-12: Issue found
❌ docs/file2.md:20-22: Issue found
❌ Found 2 file(s) with issues
```

✅ **正常系も確認**
```bash
# 良い例
$ ./tools/check-tool.sh docs/
✅ No issues found
```

---

## 📖 参考

### 過去の失敗例

**問題**: 連続区切り線チェックツール（2025-11-01）
- grep -Pzo でリダイレクトしていた
- 実際には何も検出できていなかった
- 6ファイルのバグが長期間残存

**教訓**: 
- 既知のバグでテストしていれば防げた
- 出力を確認していれば気づけた
- シンプルな実装（awk）の方が良かった

詳細: [問題分析と教訓](07_lessons-learned.md#問題9-テストツールの検証不足)

---

## 📝 チェックリスト使用例

### 新規ツール作成時

1. このチェックリストを印刷またはコピー
2. 各項目を順番に確認
3. 全てチェック完了後に統合
4. 作業記録にチェック結果を記載

### レビュー時

1. PRでこのチェックリストを確認
2. テストコードの有無を確認
3. 既知のバグでテストされているか確認

---

**最終更新**: 2025-11-01
