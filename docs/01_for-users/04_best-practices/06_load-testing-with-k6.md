[ãƒ›ãƒ¼ãƒ ](../../README.md) > [ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰](../README.md) > [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](README.md) > 06 Load Testing With K6

---

# k6ã‚’ä½¿ã£ãŸè² è·ãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–


---

## ğŸ“‹ ã“ã®ã‚¬ã‚¤ãƒ‰ã«ã¤ã„ã¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€Q CLIã¨Playwright MCPã€k6ã‚’çµ„ã¿åˆã‚ã›ãŸè² è·ãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–æ–¹æ³•ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚ã‚·ãƒŠãƒªã‚ªã‚­ãƒ£ãƒ—ãƒãƒ£ã‹ã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆã€å®Ÿè¡Œã€åˆ†æã€ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã¾ã§ã®å…¨å·¥ç¨‹ã‚’ã€ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§è§£èª¬ã—ã¾ã™ã€‚

> **âš ï¸ æ³¨æ„äº‹é …**
> 
> ã“ã®ã‚¬ã‚¤ãƒ‰ã§ç´¹ä»‹ã™ã‚‹æ‰‹æ³•ã¯ã€AWS Summit 2024ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ç´¹ä»‹ã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚
> Q CLIã®ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ä¾å­˜ã™ã‚‹æ©Ÿèƒ½ã§ã¯ãªãã€MCPï¼ˆModel Context Protocolï¼‰ã¨k6ã‚’çµ„ã¿åˆã‚ã›ãŸæ±ç”¨çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚

### å¯¾è±¡èª­è€…
- è² è·ãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•åŒ–ã—ãŸã„é–‹ç™ºè€…
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®åŠ¹ç‡åŒ–ã‚’ç›®æŒ‡ã™ãƒãƒ¼ãƒ 
- Q CLIã®é«˜åº¦ãªæ´»ç”¨æ–¹æ³•ã‚’å­¦ã³ãŸã„æ–¹

---

## ğŸ¬ å‚è€ƒå‹•ç”»

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€ä»¥ä¸‹ã®AWS Summit 2024ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ç´¹ä»‹ã•ã‚ŒãŸæ‰‹æ³•ã‚’åŸºã«ã—ã¦ã„ã¾ã™ã€‚

**[ç”Ÿæˆ AI æ™‚ä»£ã®è² è·ãƒ†ã‚¹ãƒˆ on AWS ã€œ AI ã¯è² è·ãƒ†ã‚¹ãƒˆã‚’ã©ã‚Œã ã‘çˆ†é€Ÿã«ã§ãã‚‹ã‹ï¼Ÿã€œ](https://www.youtube.com/watch?v=beR_FEwPo74)**

**å‹•ç”»ã®å†…å®¹**:
- Q CLIã‚’AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦æ´»ç”¨ã—ãŸè² è·ãƒ†ã‚¹ãƒˆã®è‡ªå‹•åŒ–
- Playwright MCPã«ã‚ˆã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã®ã‚­ãƒ£ãƒ—ãƒãƒ£
- k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è‡ªå‹•ç”Ÿæˆï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å«ã‚€ï¼‰
- AWS Observabilityã‚µãƒ¼ãƒ“ã‚¹ï¼ˆX-Rayã€CloudWatchï¼‰ã¨ã®é€£æº
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æã‹ã‚‰ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§ã®è‡ªå¾‹çš„ãªå®Ÿè¡Œ

**ç™ºè¡¨è€…**: AWSã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ  
**æ™‚é–“**: ç´„30åˆ†  
**ãƒ¬ãƒ™ãƒ«**: ä¸­ç´šã€œä¸Šç´š

---

## ğŸ¯ Q CLIã§å®Ÿç¾ã§ãã‚‹ã“ã¨

### 1. ã‚·ãƒŠãƒªã‚ªã®è‡ªå‹•ä½œæˆ

Playwright MCPã‚’ä½¿ç”¨ã—ã¦ã€å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚

**å®Ÿç¾å†…å®¹**:
- ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã®è‡ªå‹•è¨˜éŒ²
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°ã‚­ãƒ£ãƒ—ãƒãƒ£
- HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å®Œå…¨ãªè¨˜éŒ²

### 2. å®Ÿç”¨çš„ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ

ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€å®Ÿç”¨çš„ãªk6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹è¦ç´ **:
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºï¼ˆç›¸é–¢å‡¦ç†ï¼‰**: å‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰æ¬¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãªã©ï¼‰ã‚’æŠ½å‡º
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å¤±æ•—æ™‚ã®é©åˆ‡ãªå‡¦ç†
- **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«ç´ã¥ããƒªã‚¯ã‚¨ã‚¹ãƒˆã®è«–ç†çš„ãªã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- **ã‚¿ã‚°ä»˜ã‘**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã®é›†è¨ˆã®ãŸã‚ã®ã‚¿ã‚°è¨­å®š

### 3. è‡ªå¾‹çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

Q CLIãŒè‡ªå¾‹çš„ã«è² è·ãƒ†ã‚¹ãƒˆã®ã‚µã‚¤ã‚¯ãƒ«å…¨ä½“ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

**å®Ÿè¡Œå†…å®¹**:
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ†ã‚¹ãƒˆæ¡ä»¶ã®çµ±ä¸€ï¼‰
- k6ã«ã‚ˆã‚‹è² è·å®Ÿè¡Œ
- çµæœã®è‡ªå‹•è©•ä¾¡ï¼ˆé–¾å€¤ã¨ã®æ¯”è¼ƒï¼‰

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

AWS Observabilityã‚µãƒ¼ãƒ“ã‚¹ã¨é€£æºã—ã¦ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®šã—ã¾ã™ã€‚

**åˆ†æå†…å®¹**:
- AWS X-Rayã‹ã‚‰ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
- CloudWatchã‹ã‚‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ­ã‚°ã‚’åé›†
- ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®è‡ªå‹•ç‰¹å®š
- ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå¾‹å®Ÿè¡Œ

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

æœ€å°é™ã®æ‰‹é †ã§è² è·ãƒ†ã‚¹ãƒˆã‚’è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### å‰ææ¡ä»¶

- Q CLIï¼ˆæœ€æ–°ç‰ˆæ¨å¥¨ï¼‰
- Node.jsï¼ˆPlaywright MCPç”¨ï¼‰
- k6ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

### æ‰‹é †

```bash
# 1. è² è·ãƒ†ã‚¹ãƒˆç”¨Agentã‚’ä½œæˆ
cat > ~/.aws/amazonq/agents/load-test.json << 'EOF'
{
  "name": "load-test",
  "description": "k6è² è·ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
  "instructions": [
    "Playwright MCPã‚’ä½¿ã£ã¦ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹",
    "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹",
    "k6ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è©•ä¾¡ã™ã‚‹"
  ],
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["-y", "@playwright/mcp-server"]
    }
  }
}
EOF

# 2. Agentã«åˆ‡ã‚Šæ›¿ãˆ
q agent set-default load-test

# 3. ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹
q chat
```

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> https://example.com ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³ã‹ã‚‰ã‚«ãƒ¼ãƒˆæŠ•å…¥ã¾ã§ã®æ“ä½œã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦
> ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’requests.txtã«ä¿å­˜ã—ã¦
```

---

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

### Step 1: ç’°å¢ƒæº–å‚™

#### å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# k6ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSï¼‰
brew install k6

# k6ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆLinuxï¼‰
sudo gpg -k
sudo gpg --no-default-keyring --keyring /usr/share/keyrings/k6-archive-keyring.gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys C5AD17C747E3415A3642D57D77C6C491D6AC1D69
echo "deb [signed-by=/usr/share/keyrings/k6-archive-keyring.gpg] https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
sudo apt-get update
sudo apt-get install k6

# Node.jsï¼ˆPlaywright MCPç”¨ï¼‰
# ã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
```

#### Agentè¨­å®šã®ä½œæˆ

è©³ç´°ãªAgentè¨­å®šã‚’ä½œæˆã—ã¾ã™ã€‚

`~/.aws/amazonq/agents/load-test.json`:

```json
{
  "name": "load-test",
  "description": "k6è² è·ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ",
  "instructions": [
    "Playwright MCPã‚’ä½¿ã£ã¦ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹",
    "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹",
    "å®Ÿç”¨çš„ãªè¦ç´ ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ã‚¿ã‚°ä»˜ã‘ï¼‰ã‚’å«ã‚ã‚‹",
    "k6ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è©•ä¾¡ã™ã‚‹",
    "AWS Observabilityã‚µãƒ¼ãƒ“ã‚¹ï¼ˆX-Rayã€CloudWatchï¼‰ã‹ã‚‰ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚’åé›†ãƒ»åˆ†æã™ã‚‹",
    "ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®šã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹",
    "å¿…è¦ã«å¿œã˜ã¦CDKã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"
  ],
  "mcpServers": {
    "playwright": {
      "command": "npx",
      "args": ["-y", "@playwright/mcp-server"]
    }
  },
  "allowedTools": [
    "execute_bash",
    "fs_read",
    "fs_write",
    "use_aws"
  ]
}
```

---

### Step 2: ã‚·ãƒŠãƒªã‚ªã‚­ãƒ£ãƒ—ãƒãƒ£

Playwright MCPã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚

```bash
# Agentã«åˆ‡ã‚Šæ›¿ãˆ
q agent set-default load-test

# ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹
q chat
```

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> Playwrightã§ä»¥ä¸‹ã®ã‚·ãƒŠãƒªã‚ªã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ï¼š
> 1. https://example.com ã«ã‚¢ã‚¯ã‚»ã‚¹
> 2. ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
> 3. ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
> 4. å•†å“ãƒšãƒ¼ã‚¸ã«ç§»å‹•
> 5. ã‚«ãƒ¼ãƒˆã«å•†å“ã‚’è¿½åŠ 
> 6. ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
> 
> ã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’requests.txtã«ä¿å­˜ã—ã¦
```

**Q CLIã®å‹•ä½œ**:
1. Playwright MCPã‚’èµ·å‹•
2. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’è‡ªå‹•æ“ä½œ
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨˜éŒ²
4. `requests.txt`ã«ä¿å­˜

---

### Step 3: ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆ

ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> requests.txtã‹ã‚‰k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¦ï¼š
> - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰æŠ½å‡ºã—ã¦æ¬¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä½¿ç”¨
> - ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰å‡¦ç†ã‚’ä¸­æ–­
> - å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚¿ã‚°ã‚’ä»˜ã‘ã¦é›†è¨ˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
> - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹
> 
> ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’load-test.jsã«ä¿å­˜ã—ã¦
```

**ç”Ÿæˆã•ã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹**:

```javascript
import http from 'k6/http';
import { check, group } from 'k6';
import { sleep } from 'k6';

export const options = {
  stages: [
    { duration: '30s', target: 10 },
    { duration: '1m', target: 50 },
    { duration: '30s', target: 0 },
  ],
  thresholds: {
    http_req_duration: ['p(95)<500'],
    http_req_failed: ['rate<0.01'],
  },
};

export default function () {
  let authToken;

  group('Login', function () {
    const loginRes = http.post('https://example.com/api/login', 
      JSON.stringify({
        email: 'test@example.com',
        password: 'password123'
      }), 
      {
        headers: { 'Content-Type': 'application/json' },
        tags: { name: 'Login' },
      }
    );

    check(loginRes, {
      'login successful': (r) => r.status === 200,
    }) || fail('Login failed');

    authToken = loginRes.json('token');
  });

  group('Add to Cart', function () {
    const cartRes = http.post('https://example.com/api/cart', 
      JSON.stringify({
        productId: '12345',
        quantity: 1
      }), 
      {
        headers: { 
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${authToken}`
        },
        tags: { name: 'AddToCart' },
      }
    );

    check(cartRes, {
      'add to cart successful': (r) => r.status === 200,
    }) || fail('Add to cart failed');
  });

  sleep(1);
}
```

---

### Step 4: è² è·ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

k6ã‚’å®Ÿè¡Œã—ã¦è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> ä»¥ä¸‹ã®æ‰‹é †ã§è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ï¼š
> 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆreset-db.shã‚’å®Ÿè¡Œï¼‰
> 2. k6ã§load-test.jsã‚’å®Ÿè¡Œ
> 3. çµæœã‚’ç¢ºèªã—ã¦é–¾å€¤ã¨æ¯”è¼ƒ
> 4. çµæœã‚’results.txtã«ä¿å­˜
```

**Q CLIã®å‹•ä½œ**:
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
2. `k6 run load-test.js`ã‚’å®Ÿè¡Œ
3. çµæœã‚’è§£æ
4. é–¾å€¤ã¨ã®æ¯”è¼ƒã‚’å®Ÿæ–½

**k6ã®å‡ºåŠ›ä¾‹**:
```
     âœ“ login successful
     âœ“ add to cart successful

     checks.........................: 100.00% âœ“ 1000      âœ— 0
     data_received..................: 2.5 MB  42 kB/s
     data_sent......................: 500 kB  8.3 kB/s
     http_req_duration..............: avg=245ms min=120ms med=230ms max=480ms p(95)=420ms
     http_req_failed................: 0.00%   âœ“ 0        âœ— 1000
```

---

### Step 5: åˆ†æã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

AWS Observabilityã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚’åé›†ã—ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®šã—ã¾ã™ã€‚

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> AWS X-Rayã‹ã‚‰éå»1æ™‚é–“ã®ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ï¼š
> - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒ500msä»¥ä¸Šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç‰¹å®š
> - ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã£ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ†æ
> - æ”¹å–„æ¡ˆã‚’æç¤ºã—ã¦
```

**Q CLIã®å‹•ä½œ**:
1. AWS X-Ray APIã‚’å‘¼ã³å‡ºã—
2. ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ
3. ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®š
4. æ”¹å–„æ¡ˆã‚’æç¤º

**åˆ†æçµæœã®ä¾‹**:
```
ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æçµæœï¼š

1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªãŒé…ã„ï¼ˆå¹³å‡450msï¼‰
   - åŸå› : ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„
   - æ”¹å–„æ¡ˆ: user_idã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 

2. Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆåˆå›300msï¼‰
   - åŸå› : ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¸ˆã¿åŒæ™‚å®Ÿè¡Œæ•°ãŒæœªè¨­å®š
   - æ”¹å–„æ¡ˆ: ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¸ˆã¿åŒæ™‚å®Ÿè¡Œæ•°ã‚’5ã«è¨­å®š
```

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> ææ¡ˆã•ã‚ŒãŸæ”¹å–„æ¡ˆã‚’å®Ÿè£…ã—ã¦ï¼š
> 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
> 2. CDKã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¦Lambdaã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¸ˆã¿åŒæ™‚å®Ÿè¡Œæ•°ã‚’è¨­å®š
> 3. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ
> 4. å†åº¦è² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦åŠ¹æœã‚’ç¢ºèª
```

---

## âš™ï¸ Agentè¨­å®šã®è©³ç´°

### åŸºæœ¬è¨­å®š

```json
{
  "name": "load-test",
  "description": "k6è² è·ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"
}
```

### instructionsï¼ˆæŒ‡ç¤ºï¼‰

Agentã®å‹•ä½œã‚’å®šç¾©ã—ã¾ã™ã€‚

```json
"instructions": [
  "Playwright MCPã‚’ä½¿ã£ã¦ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹",
  "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹",
  "å®Ÿç”¨çš„ãªè¦ç´ ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ã‚¿ã‚°ä»˜ã‘ï¼‰ã‚’å«ã‚ã‚‹",
  "k6ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è©•ä¾¡ã™ã‚‹",
  "AWS Observabilityã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚’åé›†ãƒ»åˆ†æã™ã‚‹",
  "ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’ç‰¹å®šã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹"
]
```

### mcpServersï¼ˆMCPã‚µãƒ¼ãƒãƒ¼ï¼‰

Playwright MCPã‚’è¨­å®šã—ã¾ã™ã€‚

```json
"mcpServers": {
  "playwright": {
    "command": "npx",
    "args": ["-y", "@playwright/mcp-server"]
  }
}
```

### allowedToolsï¼ˆè¨±å¯ãƒ„ãƒ¼ãƒ«ï¼‰

å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’è¨±å¯ã—ã¾ã™ã€‚

```json
"allowedTools": [
  "execute_bash",  // k6å®Ÿè¡Œã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆç”¨
  "fs_read",       // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ç”¨
  "fs_write",      // ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”Ÿæˆç”¨
  "use_aws"        // X-Rayã€CloudWatché€£æºç”¨
]
```

---

## ğŸ’¡ Tips

### 1. ã‚·ãƒŠãƒªã‚ªã®å†åˆ©ç”¨

ä¸€åº¦ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸã‚·ãƒŠãƒªã‚ªã¯å†åˆ©ç”¨ã§ãã¾ã™ã€‚

```bash
# ã‚·ãƒŠãƒªã‚ªã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–
cp requests.txt scenarios/login-and-purchase.txt

# åˆ¥ã®ãƒ†ã‚¹ãƒˆã§å†åˆ©ç”¨
q chat
```

ãƒãƒ£ãƒƒãƒˆå†…ã§æŒ‡ç¤ºï¼š
```
> scenarios/login-and-purchase.txtã‹ã‚‰k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¦
```

### 2. è¤‡æ•°ã‚·ãƒŠãƒªã‚ªã®çµ„ã¿åˆã‚ã›

è¤‡æ•°ã®ã‚·ãƒŠãƒªã‚ªã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚ˆã‚Šç¾å®Ÿçš„ãªè² è·ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã§ãã¾ã™ã€‚

```javascript
export default function () {
  const scenario = Math.random();
  
  if (scenario < 0.5) {
    // 50%: ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦è³¼å…¥
    loginAndPurchase();
  } else if (scenario < 0.8) {
    // 30%: å•†å“é–²è¦§ã®ã¿
    browsing();
  } else {
    // 20%: ã‚«ãƒ¼ãƒˆæ”¾æ£„
    addToCartAndLeave();
  }
}
```

### 3. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ„ã¿è¾¼ã¿

GitHub Actionsã§ã®å®Ÿè¡Œä¾‹ï¼š

```yaml
name: Load Test

on:
  push:
    branches: [ main ]

jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Install k6
        run: |
          sudo apt-get update
          sudo apt-get install k6
      
      - name: Run load test
        run: k6 run load-test.js
```

### 4. æ®µéšçš„ãªè² è·å¢—åŠ 

```javascript
export const options = {
  stages: [
    { duration: '2m', target: 10 },   // ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—
    { duration: '5m', target: 50 },   // é€šå¸¸è² è·
    { duration: '2m', target: 100 },  // ãƒ”ãƒ¼ã‚¯è² è·
    { duration: '5m', target: 50 },   // é€šå¸¸è² è·ã«æˆ»ã™
    { duration: '2m', target: 0 },    // ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  ],
};
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Playwright MCPãŒèµ·å‹•ã—ãªã„

**ç—‡çŠ¶**: `npx @playwright/mcp-server`ãŒå¤±æ•—ã™ã‚‹

**è§£æ±ºæ–¹æ³•**:
```bash
# Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªï¼ˆv18ä»¥ä¸ŠãŒå¿…è¦ï¼‰
node --version

# Playwrightã‚’æ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g @playwright/mcp-server
```

### k6ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

**ç—‡çŠ¶**: ç”Ÿæˆã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå‹•ä½œã—ãªã„

**è§£æ±ºæ–¹æ³•**:
1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
2. Q CLIã«ä¿®æ­£ã‚’ä¾é ¼

```
> load-test.jsã‚’å®Ÿè¡Œã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸï¼š
> [ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸]
> 
> ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä¿®æ­£ã—ã¦
```

### AWS X-Rayã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„

**ç—‡çŠ¶**: ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ‡ãƒ¼ã‚¿ãŒç©º

**è§£æ±ºæ–¹æ³•**:
1. X-RayãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
2. IAMæ¨©é™ã‚’ç¢ºèª

```bash
# X-Rayã®æœ‰åŠ¹åŒ–ç¢ºèª
aws xray get-sampling-rules

# IAMæ¨©é™ã®ç¢ºèª
aws iam get-user-policy --user-name your-user --policy-name XRayAccess
```

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[å®Ÿè·µçš„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹](04_use-cases.md)** - ä»–ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ä¾‹
- **[MCPè¨­å®šã‚¬ã‚¤ãƒ‰](../03_configuration/04_mcp-configuration.md)** - MCPè¨­å®šã®è©³ç´°
- **[Agentè¨­å®šã‚¬ã‚¤ãƒ‰](../03_configuration/03_agent-configuration.md)** - Agentè¨­å®šã®è©³ç´°
- **[ç’°å¢ƒå¤‰æ•°ã‚¬ã‚¤ãƒ‰](../03_configuration/06_environment-variables.md)** - ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

### å¤–éƒ¨ãƒªãƒ³ã‚¯

- **[AWS Labs MCP](https://github.com/awslabs/mcp)** - AWSå…¬å¼MCPã‚µãƒ¼ãƒãƒ¼ï¼ˆPlaywrightä»¥å¤–ã®MCPã‚µãƒ¼ãƒãƒ¼ï¼‰
- [k6å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://k6.io/docs/)
- [Playwrightå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://playwright.dev/)
- [AWS X-Ray](https://aws.amazon.com/xray/)
- [AWS CloudWatch](https://aws.amazon.com/cloudwatch/)

---


---

**é–¢é€£ãƒˆãƒ”ãƒƒã‚¯**:
- [ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•](../06_troubleshooting/02_common-issues.md)
- [FAQ](../06_troubleshooting/01_faq.md)

---

æœ€çµ‚æ›´æ–°: 2025-10-26
