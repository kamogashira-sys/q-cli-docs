[ãƒ›ãƒ¼ãƒ ](../../README.md) > [ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰](../README.md) > [ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã‚¬ã‚¤ãƒ‰](README.md) > 02 Mechanism

---

## 2. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä»•çµ„ã¿ã¨ç®¡ç†

### 2.1 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ã€Agentèµ·å‹•ã‹ã‚‰ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã¾ã§ã€æ˜ç¢ºãªãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

#### èª­ã¿è¾¼ã¿ï¼ˆAgentèµ·å‹•æ™‚ï¼‰

**å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œ**:

Agentèµ·å‹•æ™‚ã€ä»¥ä¸‹ã®é †åºã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ï¼š

```
1. Agentè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
   â†“
2. resourcesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è§£æ
   â†“
3. å„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®è§£æ±º
   - ç›¸å¯¾ãƒ‘ã‚¹ â†’ çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›ï¼ˆcwdåŸºæº–ï¼‰
   - Globãƒ‘ã‚¿ãƒ¼ãƒ³ â†’ ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã«å±•é–‹
   - file://ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®æ¤œè¨¼
   â†“
4. ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
   - å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é †æ¬¡èª­ã¿è¾¼ã¿
   - UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§è§£æ
   - ãƒˆãƒ¼ã‚¯ãƒ³åŒ–
   â†“
5. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ã®é…ç½®
   - ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã®è¨ˆç®—
   - 75%åˆ¶é™ã®ãƒã‚§ãƒƒã‚¯
   - è¶…éãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ãƒ‰ãƒ­ãƒƒãƒ—
```

**èª­ã¿è¾¼ã¿é †åº**:

```json
{
  "resources": [
    "file://README.md",           // 1ç•ªç›®
    "file://.amazonq/rules/**/*.md", // 2ç•ªç›®ï¼ˆå±•é–‹å¾Œã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼‰
    "file://docs/guide.md"        // 3ç•ªç›®
  ]
}
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: ãƒ•ã‚¡ã‚¤ãƒ«ã¯è¨­å®šã«è¨˜è¼‰ã—ãŸé †åºã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ãŒã€Globãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å±•é–‹å¾Œã«ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ãªã‚Šã¾ã™ã€‚

âš ï¸ **æ³¨æ„**: èª­ã¿è¾¼ã¿é †åºã«ä¾å­˜ã—ãŸè¨­å®šã¯é¿ã‘ã¾ã—ã‚‡ã†ã€‚é †åºãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### ä¿æŒï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ï¼‰

**ãƒ¡ãƒ¢ãƒªç®¡ç†**:

èª­ã¿è¾¼ã¾ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ãƒ¡ãƒ¢ãƒªã«ä¿æŒã•ã‚Œã¾ã™ï¼š

- Agent Resourcesã¯å¸¸ã«ä¿æŒ
- Session Contextã¯è¿½åŠ ãƒ»å‰Šé™¤å¯èƒ½
- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã¯å¸¸æ™‚ç›£è¦–

**ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆ100%ï¼‰     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent Resources: 1,100 tokens      â”‚ â† å¸¸æ™‚æ¶ˆè²»
â”‚  Session Context: 500 tokens        â”‚ â† å¸¸æ™‚æ¶ˆè²»
â”‚  ä¼šè©±å±¥æ­´: 300 tokens               â”‚
â”‚  å¿œç­”ç”Ÿæˆ: æ®‹ã‚Š                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä½¿ç”¨ã—ã¦ã„ãªãã¦ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¶ˆè²»ã—ç¶šã‘ã¾ã™ã€‚

#### æ›´æ–°ï¼ˆå‹•çš„è¿½åŠ ãƒ»å‰Šé™¤ï¼‰

**`/context`ã‚³ãƒãƒ³ãƒ‰**:

ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‹•çš„ã«å¤‰æ›´ã§ãã¾ã™ï¼š

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
> /context add docs/api-spec.md
Added 1 path(s) to context.

# ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
> /context rm docs/api-spec.md
Removed 1 path(s) from context.

# ã™ã¹ã¦ã‚¯ãƒªã‚¢
> /context clear
Cleared context
```

**å³æ™‚åæ˜ **:

å¤‰æ›´ã¯å³åº§ã«åæ˜ ã•ã‚Œã¾ã™ï¼š

```
è¿½åŠ å‰: 1,100 tokens
  â†“ /context add (500 tokens)
è¿½åŠ å¾Œ: 1,600 tokens ï¼ˆå³åº§ã«åæ˜ ï¼‰
```

ğŸ“ **å®Ÿä¾‹**:
```bash
> /context show
Total: ~1100 tokens

> /context add docs/large-file.md
Added 1 path(s) to context.

> /context show
Total: ~1600 tokens  # å³åº§ã«å¢—åŠ 
```

âš ï¸ **æ³¨æ„**: Agent Resourcesã¯`/context`ã‚³ãƒãƒ³ãƒ‰ã§å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚Agentè¨­å®šã‚’ç·¨é›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### ç ´æ£„ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ï¼‰

**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**:

ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã€ä»¥ä¸‹ã®å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

```
1. Session Contextã®ç ´æ£„
   - /context addã§è¿½åŠ ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
   - ä¸€æ™‚çš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
   â†“
2. Agent Resourcesã®ä¿æŒ
   - æ¬¡å›èµ·å‹•æ™‚ã«å†åˆ©ç”¨
   - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜éŒ²
   â†“
3. Knowledge Basesã®ä¿æŒ
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒ
   - æ¬¡å›èµ·å‹•æ™‚ã«åˆ©ç”¨å¯èƒ½
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: Session Contextã¯ã€Œä½¿ã„æ¨ã¦ã€ã€Agent Resourcesã¯ã€Œå†åˆ©ç”¨å¯èƒ½ã€ã¨è¦šãˆã¾ã—ã‚‡ã†ã€‚

---

### 2.2 ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®è©³ç´°

#### ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã¯ä½•ã‹

**å®šç¾©**:

ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€AIãŒãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹æœ€å°å˜ä½ã§ã™ã€‚å˜èªã‚„æ–‡å­—ã®ä¸€éƒ¨ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚

**ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ã®ä¾‹**:

```
è‹±èª:
"Hello, World!" 
â†’ ["Hello", ",", " World", "!"] 
â†’ ç´„3ãƒˆãƒ¼ã‚¯ãƒ³

æ—¥æœ¬èª:
"ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œï¼"
â†’ ["ã“ã‚“", "ã«ã¡", "ã¯", "ã€", "ä¸–ç•Œ", "ï¼"]
â†’ ç´„5-7ãƒˆãƒ¼ã‚¯ãƒ³
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: æ—¥æœ¬èªã¯è‹±èªã‚ˆã‚Šã‚‚ãƒˆãƒ¼ã‚¯ãƒ³æ•°ãŒå¤šããªã‚‹å‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚

#### ãƒˆãƒ¼ã‚¯ãƒ³ã®è¨ˆç®—æ–¹æ³•

**ç›®å®‰**:

| è¨€èª | 1ãƒˆãƒ¼ã‚¯ãƒ³ã‚ãŸã‚Šã®æ–‡å­—æ•° |
|------|----------------------|
| è‹±èª | ç´„4æ–‡å­— |
| æ—¥æœ¬èª | ç´„2-3æ–‡å­— |
| ã‚³ãƒ¼ãƒ‰ | ç´„3-4æ–‡å­— |

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‹ã‚‰ã®æ¨å®š**:

```
è‹±èªãƒ†ã‚­ã‚¹ãƒˆ:
5KB â‰ˆ 5,000æ–‡å­— â‰ˆ 1,250ãƒˆãƒ¼ã‚¯ãƒ³

æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆ:
5KB â‰ˆ 2,500æ–‡å­— â‰ˆ 830-1,250ãƒˆãƒ¼ã‚¯ãƒ³

ã‚³ãƒ¼ãƒ‰:
5KB â‰ˆ 5,000æ–‡å­— â‰ˆ 1,250-1,660ãƒˆãƒ¼ã‚¯ãƒ³
```

ğŸ“ **å®Ÿä¾‹**:
```
README.md (5KB, è‹±èªä¸­å¿ƒ)
â†’ ç´„1,250ãƒˆãƒ¼ã‚¯ãƒ³

.amazonq/rules/security.md (2KB, æ—¥æœ¬èªä¸­å¿ƒ)
â†’ ç´„500-660ãƒˆãƒ¼ã‚¯ãƒ³
```

âš ï¸ **æ³¨æ„**: ã“ã‚Œã¯ç›®å®‰ã§ã™ã€‚æ­£ç¢ºãªãƒˆãƒ¼ã‚¯ãƒ³æ•°ã¯`/context show`ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚

#### ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ï¼ˆ75%ãƒ«ãƒ¼ãƒ«ï¼‰

**å…¬å¼åˆ¶é™**:

ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®**æœ€å¤§75%**ã¾ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

```
ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦: 100,000ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆä¾‹ï¼‰
  â”œâ”€ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: æœ€å¤§75,000ãƒˆãƒ¼ã‚¯ãƒ³
  â””â”€ ä¼šè©±å±¥æ­´ãƒ»å¿œç­”: æœ€ä½25,000ãƒˆãƒ¼ã‚¯ãƒ³
```

**åˆ¶é™ã‚’è¶…ãˆãŸå ´åˆ**:

```
è¨­å®š: 5ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆè¨ˆ80,000ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
  â†“
èª­ã¿è¾¼ã¿æ™‚: 75%åˆ¶é™ãƒã‚§ãƒƒã‚¯
  â†“
çµæœ: ä¸€éƒ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•çš„ã«ãƒ‰ãƒ­ãƒƒãƒ—
  â†“
è­¦å‘Š: "Some files were dropped due to token limit"
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: 75%åˆ¶é™ã¯ã€Œå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã€ã§ã™ã€‚ä¼šè©±å±¥æ­´ã¨å¿œç­”ã®ãŸã‚ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚

ğŸ“ **å®Ÿä¾‹**:
```bash
> /context show
Total: ~78000 tokens  # 75%ã‚’è¶…é

# è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹
Warning: Context usage exceeds 75% limit
Some files may be dropped
```

#### ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®ç›£è¦–

**`/context show`ã®ä½¿ã„æ–¹**:

```bash
> /context show
ğŸ‘¤ Agent (my-agent):
    README.md (1 match)
    .amazonq/rules/**/*.md (3 matches)

ğŸ’¬ Session (temporary):
    docs/api-spec.md (1 match)

5 matched files in use:
ğŸ‘¤ README.md (~250 tkns)
ğŸ‘¤ .amazonq/rules/security.md (~180 tkns)
ğŸ‘¤ .amazonq/rules/coding-standards.md (~320 tkns)
ğŸ‘¤ .amazonq/rules/best-practices.md (~200 tkns)
ğŸ’¬ docs/api-spec.md (~150 tkns)

Total: ~1100 tokens
```

**å‡ºåŠ›ã®èª­ã¿æ–¹**:

1. **ğŸ‘¤ Agent**: Agent Resourcesã‹ã‚‰èª­ã¿è¾¼ã¾ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
2. **ğŸ’¬ Session**: Session Contextã§è¿½åŠ ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
3. **~XXX tkns**: å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒˆãƒ¼ã‚¯ãƒ³æ•°ï¼ˆæ¦‚ç®—ï¼‰
4. **Total**: åˆè¨ˆãƒˆãƒ¼ã‚¯ãƒ³æ•°

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: å®šæœŸçš„ã«`/context show`ã§ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

âš ï¸ **ç›£è¦–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
- Agentè¨­å®šå¤‰æ›´å¾Œ
- å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ãŸå¾Œ
- å¿œç­”ãŒé…ããªã£ãŸæ™‚

---

### 2.3 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å„ªå…ˆé †ä½

#### Agent Resources vs Session Context

ä¸¡æ–¹ã«åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã€**Session ContextãŒå„ªå…ˆ**ã•ã‚Œã¾ã™ï¼š

```
Agentè¨­å®š:
{
  "resources": ["file://README.md"]  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³1
}

ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­:
> /context add README.md  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ï¼ˆæ›´æ–°ç‰ˆï¼‰

çµæœ: ãƒãƒ¼ã‚¸ãƒ§ãƒ³2ãŒä½¿ç”¨ã•ã‚Œã‚‹
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: Session Contextã§ä¸€æ™‚çš„ã«ä¸Šæ›¸ãã§ãã¾ã™ã€‚

#### è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿é †åº

ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®é †åºã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ï¼š

1. Agent Resourcesã®é †åº
2. Globãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †
3. Session Contextã¯è¿½åŠ é †

```json
{
  "resources": [
    "file://README.md",              // 1ç•ªç›®
    "file://.amazonq/rules/a.md",    // 2ç•ªç›®
    "file://.amazonq/rules/b.md",    // 3ç•ªç›®
    "file://docs/guide.md"           // 4ç•ªç›®
  ]
}
```

âš ï¸ **æ³¨æ„**: èª­ã¿è¾¼ã¿é †åºã«ä¾å­˜ã—ãªã„ã‚ˆã†ã«è¨­è¨ˆã—ã¾ã—ã‚‡ã†ã€‚

#### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä¸Šæ›¸ããƒ«ãƒ¼ãƒ«

åŒã˜æƒ…å ±ãŒè¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹å ´åˆï¼š

- **å¾Œã‹ã‚‰èª­ã¿è¾¼ã¾ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå„ªå…ˆ**ã•ã‚Œã‚‹å‚¾å‘
- ãŸã ã—ã€AIã¯ä¸¡æ–¹ã®æƒ…å ±ã‚’è€ƒæ…®ã™ã‚‹
- çŸ›ç›¾ãŒã‚ã‚‹å ´åˆã€AIãŒåˆ¤æ–­ã™ã‚‹

ğŸ“ **å®Ÿä¾‹**:
```
README.md: "Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³: 3.8"
docs/setup.md: "Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³: 3.9"

AIã®å¿œç­”: "Python 3.9ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼ˆæœ€æ–°ã®æƒ…å ±ã«åŸºã¥ãï¼‰"
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: çŸ›ç›¾ã™ã‚‹æƒ…å ±ã¯é¿ã‘ã€ä¸€ç®‡æ‰€ã«ã¾ã¨ã‚ã¾ã—ã‚‡ã†ã€‚

---

### 2.4 Q CLIã§ã®ç®¡ç†æ–¹æ³•

#### Agent Resourcesã®è¨­å®š

**`resources`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä»•æ§˜**:

JSON Schemaã«ã‚ˆã‚‹å®šç¾©ï¼š

```json
"resources": {
  "description": "Files to include in the agent's context",
  "type": "array",
  "items": {
    "type": "string",
    "pattern": "^(file://)"
  },
  "default": []
}
```

**å¿…é ˆè¦ä»¶**:
- `file://`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒå¿…é ˆ
- é…åˆ—å½¢å¼
- æ–‡å­—åˆ—è¦ç´ 

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŒ‡å®šæ–¹æ³•**:

1. **ç›¸å¯¾ãƒ‘ã‚¹**ï¼ˆæ¨å¥¨ï¼‰:
```json
{
  "resources": [
    "file://README.md",
    "file://./docs/guide.md"
  ]
}
```

2. **çµ¶å¯¾ãƒ‘ã‚¹**:
```json
{
  "resources": [
    "file:///home/user/project/README.md"
  ]
}
```

3. **ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**:
```json
{
  "resources": [
    "file://~/.aws/amazonq/common-rules.md"
  ]
}
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: ç›¸å¯¾ãƒ‘ã‚¹ã‚’ä½¿ã†ã¨ã€ãƒãƒ¼ãƒ ã§å…±æœ‰ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

**Globãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨**:

```json
{
  "resources": [
    "file://.amazonq/rules/*.md",      // ç›´ä¸‹ã®.mdãƒ•ã‚¡ã‚¤ãƒ«
    "file://.amazonq/rules/**/*.md",   // ã™ã¹ã¦ã®å­å­«ã®.mdãƒ•ã‚¡ã‚¤ãƒ«
    "file://docs/**/*.{md,txt}"        // è¤‡æ•°æ‹¡å¼µå­
  ]
}
```

**Globãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‹•ä½œ**ï¼ˆgitignoreå½¢å¼ï¼‰:

- `*`: å˜ä¸€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ¬ãƒ™ãƒ«å†…ã§ãƒãƒƒãƒ
- `**`: ã™ã¹ã¦ã®å­å­«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å†å¸°çš„ã«ãƒãƒƒãƒ
- `?`: 1æ–‡å­—ã«ãƒãƒƒãƒ
- `{a,b}`: aã¾ãŸã¯bã«ãƒãƒƒãƒ

ğŸ“ **å®Ÿä¾‹**:
```json
{
  "resources": [
    "file://.amazonq/rules/**/*.md"
  ]
}

ãƒãƒƒãƒã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:
- .amazonq/rules/security.md
- .amazonq/rules/coding/standards.md
- .amazonq/rules/coding/best-practices.md
```

âš ï¸ **æ³¨æ„**: åºƒã™ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒãƒã—ã€ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ã‚’è¶…ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### Session Contextã®æ“ä½œ

**`/context add`ã‚³ãƒãƒ³ãƒ‰**:

```bash
# å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
> /context add README.md
Added 1 path(s) to context.

# è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ ï¼ˆGlobãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
> /context add docs/*.md
Added 3 path(s) to context.

# çµ¶å¯¾ãƒ‘ã‚¹
> /context add /home/user/project/file.md
Added 1 path(s) to context.
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: Globãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚

**`/context rm`ã‚³ãƒãƒ³ãƒ‰**:

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
> /context rm docs/api-spec.md
Removed 1 path(s) from context.

# è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
> /context rm docs/*.md
Removed 3 path(s) from context.
```

**`/context clear`ã‚³ãƒãƒ³ãƒ‰**:

```bash
# ã™ã¹ã¦ã®Session Contextã‚’ã‚¯ãƒªã‚¢
> /context clear
Cleared context
Note: Agent-defined context is not affected.
```

âš ï¸ **æ³¨æ„**: Agent Resourcesã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ã€‚

**`/context show`ã‚³ãƒãƒ³ãƒ‰**:

```bash
# ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
> /context show
ğŸ‘¤ Agent (my-agent):
    README.md (1 match)
    .amazonq/rules/**/*.md (3 matches)

ğŸ’¬ Session (temporary):
    docs/api-spec.md (1 match)

Total: ~1100 tokens
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: è¨­å®šå¤‰æ›´å¾Œã¯å¿…ãš`/context show`ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

#### Knowledge Basesã®æ´»ç”¨

**ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**:

```bash
# Knowledge Basesã‚’æœ‰åŠ¹åŒ–
> q settings chat.enableKnowledge true
```

**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¿½åŠ **:

```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’è¿½åŠ 
> /knowledge add /path/to/large-codebase

# ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿è¿½åŠ 
> /knowledge add /path/to/codebase --include "**/*.py"

# é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³æŒ‡å®š
> /knowledge add /path/to/codebase --include "**/*.py" --exclude "node_modules/**"
```

**æ¤œç´¢ã¨æ´»ç”¨**:

```bash
# ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
> /knowledge search "authentication patterns"

# æ¤œç´¢çµæœãŒè‡ªå‹•çš„ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã‚‹
```

ğŸ’¡ **åˆå¿ƒè€…å‘ã‘ãƒã‚¤ãƒ³ãƒˆ**: Knowledge Basesã¯ã€Œå¿…è¦ãªæ™‚ã ã‘æ¤œç´¢ã€ã™ã‚‹ã®ã§ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¯€ç´„ã§ãã¾ã™ã€‚

ğŸ“ **å®Ÿä¾‹**:
```bash
# å¤§è¦æ¨¡ãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ï¼ˆ50MBï¼‰ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–
> /knowledge add ./src --include "**/*.py"
Indexing 1,234 files...
Done. Knowledge base created.

# å¿…è¦ãªæ™‚ã ã‘æ¤œç´¢
> /knowledge search "user authentication"
Found 5 relevant files.
Added to context: auth.py, user_model.py
```

---

## ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

â† **å‰ã¸**: [ç¬¬1ç« : ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æœ¬è³ª](01_essence.md) | **æ¬¡ã¸**: [ç¬¬3ç« : ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åŠ¹æœã¨ç‰¹å¾´](03_effects.md) â†’

---

æœ€çµ‚æ›´æ–°: 2025-10-26

