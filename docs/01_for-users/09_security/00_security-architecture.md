[ホーム](../../README.md) > [ユーザーガイド](../README.md) > [セキュリティガイド](README.md) > 00 Security Architecture

---

# セキュリティアーキテクチャ設計思想

**対象**: Amazon Q Developer CLI / Kiro CLI

---

## 📋 概要

このガイドでは、Amazon Q Developer CLI（Q CLI）およびKiro CLIが**なぜユーザーアカウント配下にインストールされるのか**という根本的な設計思想と、その技術的・セキュリティ的理由を詳しく解説します。

---

## 🏗️ なぜユーザーアカウント配下にインストールされるのか

### 基本的な疑問

多くのCLIツール（Docker CLI、kubectl、terraform等）は`/usr/local/bin`などシステム全体で共有される場所にインストールされます。しかし、Q CLI/Kiro CLIは**意図的に**ユーザーアカウント配下（`~/.local/bin`）にインストールされます。

この設計には、深い技術的・セキュリティ的理由があります。

---

## 🔒 AWS公式セキュリティモデル

### セキュリティモデルの4つの基本原則

AWS公式ドキュメント「[MCP Security](https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/command-line-mcp-security.html)」で定義されている基本原則：

```
セキュリティモデルの基本原則:
├── Local execution: MCP servers run on the user's machine
├── Explicit permission: tools require user approval before execution
├── Isolation: each MCP server operates as a separate process
└── Transparency: users can view available tools and their functions
```

### 1. ローカル実行（Local Execution）

**AWS公式の定義**:
> "Local execution signifies that MCP servers run on the user's machine"

**技術的意味**:
- すべての処理がユーザーのマシン上で実行される
- 外部サーバーへの依存を最小化
- ネットワーク分離された環境でも動作可能
- データの外部流出リスクを軽減

### 2. 明示的許可（Explicit Permission）

**AWS公式の定義**:
> "Explicit permission means that tools require user approval before execution"

**実装の詳細**:
- 各ツール実行前にユーザー承認を要求
- デフォルトで安全側に倒れる設計
- 意図しない操作の防止
- 透明性のある操作ログ

### 3. プロセス分離（Isolation）

**技術的実装**:
- 各MCPサーバーは独立したプロセスとして動作
- プロセス間の影響を最小化
- 障害時の影響範囲を限定
- セキュリティ境界の明確化

### 4. 透明性（Transparency）

**ユーザー体験**:
- 利用可能なツールと機能を確認可能
- 実行内容の可視化
- 操作履歴の追跡
- デバッグ情報の提供

---

## 🎯 ユーザーアカウント配下インストールの技術的理由

### 1. セキュリティモデルとの整合性

```
ローカル実行セキュリティの実現:
├── ユーザーマシン上での完全な実行
│   └── 「Local execution signifies that MCP servers run on the user's machine」
├── 明示的許可制の実装
│   └── 「Explicit permission means that tools require user approval before execution」
├── プロセス分離の確保
│   └── 各MCPサーバーは独立したプロセスとして動作
└── 透明性の提供
    └── ユーザーが利用可能なツールと機能を確認可能
```

### 2. 権限管理の最適化

```
管理者権限不要の利点:
├── インストール時の権限要求なし
│   └── sudo権限不要でインストール可能
├── 企業環境での導入容易性
│   └── IT管理者の承認プロセス簡略化
├── セキュリティリスク軽減
│   └── システム全体への影響を回避
└── ユーザー自律性
    └── 個人の開発環境での自由な利用
```

### 3. ユーザー固有設定とデータ分離

```
個人環境の分離:
├── 設定ファイルの分離
│   ├── ~/.q/ または ~/.kiro/ ディレクトリ
│   ├── 個人のAWS認証情報
│   └── 個人のプロジェクト設定
├── データの分離
│   ├── 会話履歴の個人管理
│   ├── MCPサーバー設定
│   └── ログファイルの個人管理
└── マルチユーザー環境対応
    └── 同一システム上の複数ユーザーでの独立動作
```

### 4. 標準準拠（XDG Base Directory仕様）

```
Linux標準ディレクトリ構造:
├── ~/.local/bin
│   └── ユーザー固有の実行ファイル
├── ~/.local/share
│   └── ユーザー固有のデータファイル
├── ~/.config
│   └── ユーザー固有の設定ファイル
└── XDG Base Directory Specification準拠
    └── 標準的なLinux/Unix環境での推奨配置
```

### 5. 運用安全性

```
システム影響の最小化:
├── システム全体への影響回避
│   └── /usr/local/bin への影響なし
├── アンインストールの簡素化
│   └── ユーザーディレクトリ削除のみで完全除去
├── バージョン管理の独立性
│   └── ユーザーごとの異なるバージョン利用可能
└── 依存関係の分離
    └── システムライブラリとの競合回避
```

---

## 🏢 企業環境での利点

### IT管理者にとってのメリット

```
企業導入の利点:
├── IT管理者承認不要
│   └── 個人開発環境での自由導入
├── セキュリティポリシー準拠
│   └── システム全体への影響なし
├── 監査対応
│   └── ユーザーレベルでの利用状況追跡
└── コンプライアンス
    └── 個人データの分離管理
```

### セキュリティ担当者への説明材料

**1. リスク評価**:
- システム全体への影響: **なし**
- 管理者権限要求: **なし**
- 外部依存: **最小限**（ローカル実行原則）

**2. 監査証跡**:
- ユーザーレベルでの操作ログ
- 明示的許可による透明性
- プロセス分離による影響範囲限定

**3. データ保護**:
- 個人データの完全分離
- 認証情報の個人管理
- 設定ファイルの独立性

---

## 🔄 他のCLIツールとの比較

### システム全体インストール（/usr/local/bin）を使用するツール

```
システム全体インストールツール:
├── Docker CLI
│   └── 理由: システム全体でのコンテナ管理が前提
├── kubectl
│   └── 理由: Kubernetesクラスター管理の共有利用
├── terraform
│   └── 理由: インフラ管理の組織的利用
└── 共通特徴: システム全体での共有利用が前提
```

### ユーザーインストールを使用するツール

```
ユーザー固有インストールツール:
├── Node.js (nvm経由)
│   └── 理由: プロジェクトごとの異なるバージョン要件
├── Python (pyenv経由)
│   └── 理由: 開発環境の個人最適化
├── Rust (rustup経由)
│   └── 理由: ツールチェーンの個人管理
├── Q Dev CLI / Kiro CLI
│   └── 理由: AI開発ツールとしての個人特化
└── 共通特徴: ユーザー固有の設定・環境が重要
```

---

## 🤖 AI開発ツールとしての特性

### 1. 個人適応性

```
AI開発ツールの要件:
├── 個人の開発スタイル適応
│   └── 学習パターンの個人最適化
├── 機密情報の個人管理
│   └── プロジェクト固有の認証情報
├── 学習データの個人最適化
│   └── 会話履歴とコンテキスト管理
└── プライバシー保護
    └── 個人データの外部流出防止
```

### 2. クラウド開発環境との統合

```
AWS開発環境統合:
├── 個人のAWS認証情報
│   └── AWS Builder ID、IAM Identity Center
├── プロジェクト固有の設定
│   └── Agent設定、MCP設定
├── 個人の開発履歴
│   └── 会話履歴、コンテキスト
└── セキュリティトークンの管理
    └── 一時的な認証情報の安全な管理
```

### 3. 開発者体験の最適化

```
開発者体験（DX）重視:
├── 簡単なインストール
│   └── 権限要求の最小化
├── 権限要求の最小化
│   └── sudo不要でのセットアップ
├── 個人環境での自由度
│   └── カスタマイズの柔軟性
└── 迅速な導入・削除
    └── 試用とアンインストールの容易さ
```

---

## 📊 技術的詳細

### インストール場所の詳細

```
デフォルトインストール場所:
├── 実行ファイル: ~/.local/bin/q (または kiro)
├── 設定ファイル: ~/.q/ または ~/.kiro/
├── ログファイル: 一時ディレクトリ（ローカル）
└── MCPサーバー: ユーザープロセスとして実行
```

### セキュリティ実装

```
セキュリティ機能:
├── 明示的許可制
│   └── 各ツール実行前にユーザー承認要求
├── ローカル実行
│   └── すべての処理がユーザーマシン上で実行
├── プロセス分離
│   └── MCPサーバーは独立プロセス
└── 透明性
    └── 実行内容の可視化
```

---

## 🎯 設計思想の実践的意味

### 開発者への影響

**1. 導入の容易さ**:
- 管理者権限不要でのインストール
- 企業環境での迅速な導入
- 試用とアンインストールの簡単さ

**2. セキュリティの透明性**:
- 操作内容の可視化
- 明示的な許可プロセス
- プライバシー保護の確保

**3. カスタマイズの自由度**:
- 個人の開発スタイルに適応
- プロジェクト固有の設定
- 学習データの個人最適化

### セキュリティ担当者への説明材料

**1. リスク評価の根拠**:
- AWS公式セキュリティモデルへの準拠
- ローカル実行による外部依存の最小化
- プロセス分離による影響範囲の限定

**2. 監査対応の容易さ**:
- ユーザーレベルでの操作ログ
- 明示的許可による透明性
- 設定ファイルの独立性

**3. コンプライアンス対応**:
- 個人データの完全分離
- 標準ディレクトリ構造への準拠
- セキュリティポリシーとの整合性

---

## 🔗 関連ドキュメント

### セキュリティガイド
- **[セキュリティ概要](01_security-overview.md)** - 基本原則と環境別設定
- [データプライバシー](02_data-privacy.md) - プラン別のデータ使用
- [ファイルアクセス制御](03_file-access-control.md) - fs_readツールの制御
- [AWS API制御](04_aws-api-control.md) - use_awsツールの制御

### 設定ガイド
- [Agent設定](../03_configuration/03_agent-configuration.md) - プロジェクト固有の設定
- [環境変数](../03_configuration/06_environment-variables.md) - 環境変数による制御
- [MCP設定](../04_features/05_mcp-integration.md) - MCPサーバーの設定

### エンタープライズ展開
- [エンタープライズ導入ガイド](../05_deployment/01_enterprise-deployment.md) - 組織での導入
- [セキュリティチェックリスト](../05_deployment/03_security-checklist.md) - 設定確認項目

### AWS公式ドキュメント
- [MCP Security - Amazon Q Developer](https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/command-line-mcp-security.html)
- [Security in Amazon Q Developer](https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/security.html)
- [Data protection in Amazon Q Developer](https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/data-protection.html)

---

## 📖 ナビゲーション

**次へ**: [セキュリティ概要](01_security-overview.md) →

---

最終更新: 2025-12-30
