[ãƒ›ãƒ¼ãƒ ](../../README.md) > [ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰](../README.md) > [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰](README.md) > 04 Aws Api Control

---

# AWS APIåˆ¶å¾¡ã‚¬ã‚¤ãƒ‰

**æœ€çµ‚æ›´æ–°**: 2025-10-18  
**å¯¾è±¡**: Amazon Q Developer CLI

---

## ğŸ“‹ æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€Amazon Q Developer CLIã®`use_aws`ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹AWS APIå‘¼ã³å‡ºã—ã‚’åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ¯ use_awsãƒ„ãƒ¼ãƒ«ã¨ã¯

### æ©Ÿèƒ½

`use_aws`ãƒ„ãƒ¼ãƒ«ã¯ã€Amazon Q CLIãŒAWS CLIã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚

**ä¸»ãªç”¨é€”**:
- AWSãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãƒ»å¤‰æ›´ãƒ»å‰Šé™¤
- ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±ã®å–å¾—
- è¨­å®šã®ç¢ºèªãƒ»å¤‰æ›´
- ãƒ­ã‚°ã®å–å¾—

### å®Ÿè¡Œä¾‹

```bash
Amazon Q> S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã—ã¦

# å†…éƒ¨ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
aws s3 mb s3://my-bucket
```

---

## âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯

### æ½œåœ¨çš„ãªãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | èª¬æ˜ | å½±éŸ¿ |
|--------|------|------|
| **æ„å›³ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ** | EC2ã€RDSã€S3ç­‰ã®ä½œæˆ | **ã‚³ã‚¹ãƒˆç™ºç”Ÿ** |
| **ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å‰Šé™¤ | **ãƒ‡ãƒ¼ã‚¿æå¤±** |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®å¤‰æ›´** | IAMãƒãƒªã‚·ãƒ¼ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— | **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³** |
| **è¨­å®šã®ä¸Šæ›¸ã** | æœ¬ç•ªç’°å¢ƒã®è¨­å®šå¤‰æ›´ | **ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢** |

### å…·ä½“ä¾‹

**ã‚·ãƒŠãƒªã‚ª1: æ„å›³ã—ãªã„EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•**
```bash
Amazon Q> ãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦

# å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
aws ec2 run-instances --instance-type m5.24xlarge ...
# â†’ é«˜é¡ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒèµ·å‹•ã•ã‚Œã‚‹
```

**ã‚³ã‚¹ãƒˆ**: $4.608/æ™‚é–“ = $3,317/æœˆ

**ã‚·ãƒŠãƒªã‚ª2: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å‰Šé™¤**
```bash
Amazon Q> å¤ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦

# å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
aws rds delete-db-instance --db-instance-identifier prod-db
# â†’ æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå‰Šé™¤ã•ã‚Œã‚‹
```

**å½±éŸ¿**: ãƒ‡ãƒ¼ã‚¿æå¤±ã€ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢

**ã‚·ãƒŠãƒªã‚ª3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®å¤‰æ›´**
```bash
Amazon Q> ãƒãƒ¼ãƒˆ22ã‚’é–‹æ”¾ã—ã¦

# å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
aws ec2 authorize-security-group-ingress --group-id sg-xxx --protocol tcp --port 22 --cidr 0.0.0.0/0
# â†’ å…¨ä¸–ç•Œã‹ã‚‰SSHã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚‹
```

**å½±éŸ¿**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§

---

## ğŸ”’ æ¨å¥¨è¨­å®š

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã®åˆ¶é™

ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«æ¯å›åˆ¶é™ã™ã‚‹æ–¹æ³•ï¼š

```bash
q chat
Amazon Q> /tools untrust use_aws
```

**åŠ¹æœ**:
- AWS APIå‘¼ã³å‡ºã—å‰ã«ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã¾ã§æœ‰åŠ¹

### æ°¸ç¶šçš„ãªåˆ¶é™ï¼ˆæ¨å¥¨ï¼‰

ã‚·ã‚§ãƒ«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’è¿½åŠ ï¼š

**bash**:
```bash
echo 'alias q="q --untrust-use-aws"' >> ~/.bashrc
source ~/.bashrc
```

**zsh**:
```bash
echo 'alias q="q --untrust-use-aws"' >> ~/.zshrc
source ~/.zshrc
```

**åŠ¹æœ**:
- ã™ã¹ã¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§è‡ªå‹•çš„ã«åˆ¶é™ã•ã‚Œã‚‹
- æœ€ã‚‚å®‰å…¨ãªæ–¹æ³•

### Agentè¨­å®šã§ã®åˆ¶é™

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«åˆ¶é™ã™ã‚‹æ–¹æ³•ï¼š

**`.q/agent.json`**:
```json
{
  "name": "production-project",
  "untrustedTools": ["use_aws"]
}
```

**åŠ¹æœ**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§è‡ªå‹•é©ç”¨
- ãƒãƒ¼ãƒ å…¨ä½“ã§å…±æœ‰å¯èƒ½

---

## ğŸ›¡ï¸ IAMãƒãƒªã‚·ãƒ¼ã§ã®åˆ¶é™

### æœ€å°æ¨©é™ã®åŸå‰‡

**èª­ã¿å–ã‚Šå°‚ç”¨ãƒãƒªã‚·ãƒ¼**:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:Describe*",
        "s3:Get*",
        "s3:List*",
        "rds:Describe*",
        "cloudwatch:Get*",
        "cloudwatch:List*"
      ],
      "Resource": "*"
    }
  ]
}
```

**åŠ¹æœ**:
- ãƒªã‚½ãƒ¼ã‚¹ã®å‚ç…§ã®ã¿è¨±å¯
- ä½œæˆãƒ»å¤‰æ›´ãƒ»å‰Šé™¤ã¯ä¸å¯

### ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚°ã«ã‚ˆã‚‹åˆ¶é™

**ç‰¹å®šç’°å¢ƒã®ã¿æ“ä½œå¯èƒ½**:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:*",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "ec2:ResourceTag/Environment": "development"
        }
      }
    }
  ]
}
```

**åŠ¹æœ**:
- é–‹ç™ºç’°å¢ƒã®ã¿æ“ä½œå¯èƒ½
- æœ¬ç•ªç’°å¢ƒã¯ä¿è­·ã•ã‚Œã‚‹

---

## ğŸ¨ ç’°å¢ƒåˆ¥ã®æ¨å¥¨è¨­å®š

### é–‹ç™ºç’°å¢ƒ

**åŸºæœ¬çš„ãªä¿è­·**:
```bash
q chat --untrust-use-aws
```

**IAMãƒãƒªã‚·ãƒ¼**:
- é–‹ç™ºç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹ã®ã¿æ“ä½œå¯èƒ½
- æœ¬ç•ªç’°å¢ƒã¯èª­ã¿å–ã‚Šå°‚ç”¨

### æœ¬ç•ªç’°å¢ƒ

**å³æ ¼ãªåˆ¶é™**:
```bash
# æ°¸ç¶šçš„ãªåˆ¶é™
alias q="q --untrust-use-aws"

# Agentè¨­å®š
{
  "untrustedTools": ["use_aws", "execute_bash"]
}
```

**IAMãƒãƒªã‚·ãƒ¼**:
- èª­ã¿å–ã‚Šå°‚ç”¨
- å¤‰æ›´ã¯æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹çµŒç”±

### æ©Ÿå¯†ç’°å¢ƒ

**ã™ã¹ã¦åˆ¶é™**:
```bash
# ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ã‚’åˆ¶é™
alias q="q --untrust-all-tools"
```

**IAMãƒãƒªã‚·ãƒ¼**:
- æœ€å°é™ã®æ¨©é™
- MFAå¿…é ˆ

---

## ğŸ” ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å‹•ä½œ

### åˆ¶é™æ™‚ã®å‹•ä½œ

`use_aws`ã‚’åˆ¶é™ã™ã‚‹ã¨ã€AWS APIå‘¼ã³å‡ºã—å‰ã«ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```bash
Amazon Q> S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã—ã¦

âš ï¸  AWS API Request
Amazon Q wants to execute: aws s3 mb s3://my-bucket

Allow this action? [y/N]:
```

**é¸æŠè‚¢**:
- `y`: è¨±å¯ï¼ˆä»Šå›ã®ã¿ï¼‰
- `N`: æ‹’å¦ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- `a`: ã™ã¹ã¦è¨±å¯ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ï¼‰

---

## ğŸ› ï¸ å®‰å…¨ãªä½¿ç”¨æ–¹æ³•

### 1. å®Ÿè¡Œå‰ã«ç¢ºèª

**ã‚³ãƒãƒ³ãƒ‰ã®ç¢ºèª**:
```bash
Amazon Q> ã©ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ
# â†’ å®Ÿè¡Œäºˆå®šã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç¢ºèªã—ã¦ã‹ã‚‰è¨±å¯
```

### 2. dry-runãƒ¢ãƒ¼ãƒ‰ã®æ´»ç”¨

**dry-runã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
```bash
Amazon Q> dry-runãƒ¢ãƒ¼ãƒ‰ã§EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’èµ·å‹•ã—ã¦

# å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰
aws ec2 run-instances --dry-run ...
# â†’ å®Ÿéš›ã«ã¯å®Ÿè¡Œã•ã‚Œãšã€æ¨©é™ã®ã¿ç¢ºèª
```

### 3. ãƒ­ã‚°ã®ç›£è¦–

**CloudTrailã§ã®ç›£è¦–**:
```bash
# APIå‘¼ã³å‡ºã—ã®è¨˜éŒ²ã‚’ç¢ºèª
aws cloudtrail lookup-events --lookup-attributes AttributeKey=Username,AttributeValue=my-user
```

### 4. ã‚³ã‚¹ãƒˆç›£è¦–

**AWS Budgetsã®è¨­å®š**:
```bash
# äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š
aws budgets create-budget --account-id 123456789012 --budget file://budget.json
```

---

## ğŸ’¡ å®Ÿä¾‹

### ä¾‹1: S3ãƒã‚±ãƒƒãƒˆä½œæˆã®ç¢ºèª

**å®‰å…¨ãªæ–¹æ³•**:
```bash
Amazon Q> S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã—ãŸã„ã§ã™ã€‚ã©ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ

# ç¢ºèªå¾Œ
Amazon Q> aws s3 mb s3://my-bucket --region us-east-1
# â†’ ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§è¨±å¯
```

### ä¾‹2: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•ã®åˆ¶å¾¡

**å®‰å…¨ãªæ–¹æ³•**:
```bash
Amazon Q> t3.microã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’1å°èµ·å‹•ã—ã¦

# ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
âš ï¸  AWS API Request
Command: aws ec2 run-instances --instance-type t3.micro --count 1 ...

# ã‚³ã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ã‹ã‚‰è¨±å¯
```

### ä¾‹3: IAMãƒ­ãƒ¼ãƒ«å¤‰æ›´ã®é˜²æ­¢

**å®‰å…¨ãªæ–¹æ³•**:
```bash
# IAMãƒãƒªã‚·ãƒ¼ã§åˆ¶é™
{
  "Effect": "Deny",
  "Action": "iam:*",
  "Resource": "*"
}

# Q CLIã‹ã‚‰ã®å¤‰æ›´ã¯æ‹’å¦ã•ã‚Œã‚‹
```

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### APIå‘¼ã³å‡ºã—ãŒå¤±æ•—ã™ã‚‹

**ç—‡çŠ¶**:
```
Error: Access Denied
```

**åŸå› **:
- IAMæ¨©é™ä¸è¶³
- `use_aws`ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹

**å¯¾å‡¦**:
```bash
# æ¨©é™ã‚’ç¢ºèª
aws sts get-caller-identity

# ä¸€æ™‚çš„ã«è¨±å¯
Amazon Q> /tools trust use_aws
```

### æ¨©é™ã‚¨ãƒ©ãƒ¼ã®å¯¾å‡¦

**ç—‡çŠ¶**:
```
Error: User is not authorized to perform: ec2:RunInstances
```

**åŸå› **:
- IAMãƒãƒªã‚·ãƒ¼ã§åˆ¶é™ã•ã‚Œã¦ã„ã‚‹

**å¯¾å‡¦**:
```bash
# å¿…è¦ãªæ¨©é™ã‚’ç¢ºèª
aws iam simulate-principal-policy \
  --policy-source-arn arn:aws:iam::123456789012:user/my-user \
  --action-names ec2:RunInstances
```

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¦‚è¦](01_security-overview.md)
- [ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡](03_file-access-control.md)
- [èªè¨¼æƒ…å ±ç®¡ç†](05_credentials-management.md)

### è¨­å®šã‚¬ã‚¤ãƒ‰
- [Agentè¨­å®š](../03_configuration/03_agent-configuration.md)
- [ç’°å¢ƒå¤‰æ•°](../03_configuration/06_environment-variables.md)

### ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå±•é–‹
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](../05_deployment/03_security-checklist.md)
- [ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå°å…¥ã‚¬ã‚¤ãƒ‰](../05_deployment/01_enterprise-deployment.md)

### AWSå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Security considerations and best practices](https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/command-line-chat-security.html)
- [IAM Best Practices](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µã‚„è³ªå•ãŒã‚ã‚‹å ´åˆï¼š

1. **AWSå…¬å¼**: [AWS Security](https://aws.amazon.com/security/)
2. **GitHub**: [amazon-q-developer-cli/issues](https://github.com/aws/amazon-q-developer-cli/issues)
3. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](../06_troubleshooting/02_common-issues.md)

---

## ğŸ“– ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

â† **å‰ã¸**: [ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡](03_file-access-control.md) | **æ¬¡ã¸**: [èªè¨¼æƒ…å ±ç®¡ç†](05_credentials-management.md) â†’

---

**æœ€çµ‚æ›´æ–°**: 2025-10-18
