# 実験的機能

**最終更新**: 2025-10-18  
**対象バージョン**: v1.18.1以降

---

## 📋 目次

- [実験的機能とは](#-実験的機能とは)
- [実験的機能の比較](#-実験的機能の比較)
- [Tangent Mode](#-tangent-mode)
- [TODO Lists](#-todo-lists)
- [Context Usage Percentage](#-context-usage-percentage)
- [Thinking（思考過程表示）](#-thinking思考過程表示)
- [Delegate](#-delegatev1180)
- [注意事項](#️-注意事項)

---

## 🧪 実験的機能とは

実験的機能は、開発中の新機能を早期に試すことができる機能です。

### 特徴
- **不安定**: 予告なく変更される可能性があります
- **フィードバック歓迎**: 使用感を[GitHub Issues](https://github.com/aws/amazon-q-developer-cli/issues)で報告してください
- **段階的リリース**: 安定後に正式機能として組み込まれます

### 有効化方法

**方法1: `/experiment`コマンドを使用（推奨）**

```
> /experiment
```

表示されるメニューから有効化したい機能を選択してON/OFFを切り替えます。

**方法2: 設定コマンドを使用**

```bash
# 設定ファイルで有効化
q settings edit

# または、コマンドで有効化
q settings set <設定キー> true
```

---

## 🔍 実験的機能の比較

どの機能を使うべきか迷ったら、この比較表を参考にしてください。

| 機能 | 安定性 | 用途 | 推奨度 | 学習コスト | 対象ユーザー | バージョン |
|------|--------|------|--------|-----------|-------------|-----------|
| Checkpointing | ベータ | 作業状態の保存・復元 | ★★★★☆ | 中 | 中級者以上 | v1.17.0+ |
| Context Usage Percentage | ベータ | パフォーマンス監視 | ★★★★★ | 低 | すべて | v1.17.0+ |
| Knowledge | ベータ | 永続的コンテキスト管理 | ★★★★☆ | 中 | 中級者以上 | v1.15.0+ |
| Thinking | アルファ | デバッグ・学習 | ★★★☆☆ | 中 | 中級者以上 | - |
| Tangent Mode | ベータ | 独立した会話管理 | ★★★★☆ | 低 | 中級者以上 | v1.15.0+ |
| Delegate | アルファ | バックグラウンドタスク管理 | ★★☆☆☆ | 高 | 上級者のみ | v1.18.0+ |
| TODO Lists | アルファ | タスク管理 | ★★★☆☆ | 低 | すべて | v1.15.0+ |

### 推奨度の基準

- **★★★★★**: すべてのユーザーに推奨。安定性が高く、すぐに役立つ
- **★★★☆☆**: 中級者以上に推奨。使いこなすには理解が必要
- **★★☆☆☆**: 上級者のみ推奨。リスクを理解した上で使用

### 安定性レベル

- **ベータ**: 基本機能は安定。細かい変更の可能性あり
- **アルファ**: 開発中。大きな変更の可能性あり

### 選択ガイド

#### 初心者の方
まずは**Context Usage Indicator**から始めましょう。
```bash
q settings set chat.enableContextUsageIndicator true
```

#### 中級者の方
**Thinking**を有効にして、AIの思考過程を学びましょう。
```bash
q settings set chat.enableThinking true
```

#### 上級者の方
**Delegate Tool**でバックグラウンドタスクを管理できます。
```bash
q settings set chat.enableDelegate true
```

---

## 🔀 Tangent Mode

**追加バージョン**: v1.15.0

### 概要
コンテキスト分離された独立した会話を管理するモードです。

### 実現される機能
- **独立した会話スレッド**: メインの会話とは別の会話を開始
- **コンテキスト分離**: Tangent会話はメインのコンテキストに影響しない
- **会話の保持**: `/tangent tail`で最後のTangent会話を保持

### 有効化

**方法1: `/experiment`コマンドを使用（推奨）**

```
> /experiment
```

メニューから「Tangent Mode」を選択してONに切り替えます。

**方法2: `/tangent`コマンドを直接使用**

```
> /tangent
```

### 使用例

```bash
# メインの会話
> Pythonでファイルを読み込むコードを書いて

# Tangent会話を開始（別のトピック）
> /tangent
> JavaScriptの非同期処理について教えて

# メインの会話に戻る
> /tangent exit
```

### ユースケース
- **複数トピックの並行作業**: メインタスクを中断せずに別の質問
- **実験的な質問**: メインのコンテキストを汚さずに試行
- **一時的な調査**: 短期的な情報収集

---

## ✅ TODO Lists

**追加バージョン**: v1.15.0

### 概要
Q CLI内でタスクを管理できる機能です。

### 実現される機能
- **タスクの追加**: 新しいタスクを登録
- **タスクの完了**: タスクを完了としてマーク
- **タスクの一覧**: 登録されたタスクを表示

### 有効化

**方法1: `/experiment`コマンドを使用（推奨）**

```
> /experiment
```

メニューから「To-Do List」を選択してONに切り替えます。

### 使用例

```bash
# タスクを追加
> todo add "ドキュメントを更新する"

# タスク一覧を表示
> todo list

# タスクを完了
> todo done 1
```

### ユースケース
- **作業管理**: Q CLIでの作業タスクを管理
- **メモ**: 後で実施するタスクを記録
- **進捗追跡**: 完了したタスクを確認

---

## 📊 Context Usage Percentage

**追加バージョン**: v1.17.0

### 概要
コンテキスト使用率をリアルタイムで表示する機能です。

### 実現される機能
- **トークン使用量の可視化**: 現在のトークン数を表示
- **使用率の監視**: 最大トークン数に対する割合を表示
- **警告表示**: 上限に近づくと警告を表示

### 有効化

**方法1: `/experiment`コマンドを使用（推奨）**

```
> /experiment
```

メニューから「Context Usage Indicator」を選択してONに切り替えます。

**方法2: 設定コマンドを使用**

```bash
q settings set chat.enableContextUsageIndicator true
```

### 使用例

#### 表示内容
会話中に使用率が表示されます：

```
┌─────────────────────────────────────┐
│ Context Usage: 6,234 / 8,000 (78%) │
└─────────────────────────────────────┘

You: このコードをレビューして

Assistant: こちらがコードレビューです...

┌─────────────────────────────────────┐
│ Context Usage: 7,891 / 8,000 (99%) │ ⚠️ 警告
└─────────────────────────────────────┘
```

#### 活用シーン

**シーン1: 長い会話の管理**
```
# チャット内で使用率を確認（プロンプトに表示される）
[default] 30% > 現在のコンテキスト使用率は？

# 上限に近づいたら/compactで要約
[default] 85% > /compact
```

**シーン2: 大きなファイルの処理**
```
# チャット内で大きなファイルを読み込む前に確認
[default] 30% > このファイルを読み込むとコンテキストはどのくらい使う？
```

**シーン3: パフォーマンス最適化**
```
# 使用率が高い場合は/compactで要約
[default] 75% > /compact
```

### トラブルシューティング

#### 表示されない場合
```bash
# 設定を確認
q settings show chat.enableContextUsageIndicator

# 再起動
q restart
```

#### 使用率が100%に達した場合
```
# チャットセッション内で実行
> /clear          # 会話履歴をクリア
> /compact        # コンテキストを要約して圧縮
> /quit           # セッションを終了（新規セッションは再度 q chat で開始）
```

---

## 🧠 Thinking（思考過程表示）

### 概要
AIの思考過程をリアルタイムで表示する機能です。

### 実現される機能
- **思考の可視化**: AIがどう考えているかを表示
- **判断理由の理解**: なぜその回答になったかを理解
- **デバッグ支援**: 期待と異なる回答の原因を特定

### 有効化

**方法1: `/experiment`コマンドを使用（推奨）**

```
> /experiment
```

メニューから「Thinking」を選択してONに切り替えます。

**方法2: 設定コマンドを使用**

```bash
q settings set chat.enableThinking true
```

### 使用例

#### 表示内容
```
You: Pythonで素数判定関数を作って

💭 Thinking...
  1. 素数判定のアルゴリズムを検討
     - 試し割り法: シンプルだが遅い
     - エラトステネスの篩: 高速だが大量の数には不向き
     - ミラー・ラビン法: 確率的だが高速
  
  2. ユーザーの要件を推測
     - 教育目的 → シンプルな実装
     - 本番環境 → 高速な実装
     - 要件不明 → 汎用的な実装を提案
  
  3. 実装方針の決定
     - 試し割り法をベースに最適化
     - 2と偶数を特別扱い
     - √nまでチェック

Assistant: 素数判定関数を作成します...
```

#### 活用シーン

**シーン1: デバッグ**
期待と異なる回答が返ってきた場合、思考過程を確認して原因を特定

**シーン2: 学習**
AIの問題解決アプローチを学ぶ

**シーン3: 検証**
AIの判断が適切かを確認

### 有効/無効の切り替え
```bash
# 有効化
q settings set chat.enableThinking true

# 無効化
q settings set chat.enableThinking false

# 現在の設定を確認
q settings show chat.enableThinking
```

---

## 🤖 Delegate（v1.18.0+）

### 概要
バックグラウンドで独立して動作するエージェントプロセスを起動・管理する機能です。複数のエージェントを並行して管理し、それぞれに1つのタスクを委譲できます。

> **⚠️ 重要な安全性に関する警告**
> 
> Delegateは強力な機能ですが、以下の点に十分注意してください：
> 
> - **ファイル操作**: AIが自動的にファイルを作成・変更・削除する可能性があります
> - **コマンド実行**: システムコマンドが自動実行される場合があります
> - **外部アクセス**: ネットワーク経由で外部サービスにアクセスする可能性があります
> - **本番環境での使用禁止**: 開発環境でのみ使用してください
> - **バックアップ必須**: 重要なファイルは事前にバックアップしてください
> - **権限の最小化**: Agent設定で必要最小限の権限のみを付与してください
> 
> **推奨される使用環境:**
> - 開発環境またはテスト環境
> - Gitなどのバージョン管理システムで管理されているプロジェクト
> - 重要なデータのバックアップが取られている環境

### 実現される機能
- **バックグラウンド実行**: タスクをエージェントに委譲し、非同期で実行
- **複数エージェント管理**: 複数のエージェントを並行して管理可能
- **状態の永続化**: 実行状態は `~/.aws/amazonq/.subagents/` に保存
- **クラッシュ検出**: PIDモニタリングによるプロセス監視

### 有効化

**方法1: `/experiment`コマンドを使用（推奨）**

```
> /experiment
```

メニューから「Delegate」を選択してONに切り替えます。

**方法2: 設定コマンドを使用**

```bash
q settings set chat.enableDelegate true
```

### 操作方法

Delegate Toolは以下の3つの操作をサポートします：

#### 1. タスクの起動（launch）
```json
{
  "operation": "launch",
  "agent": "rust-agent",
  "task": "Create snake game"
}
```

#### 2. ステータス確認（status）
```json
{
  "operation": "status",
  "agent": "rust-agent"
}
```

#### 3. 利用可能なエージェント一覧（list）
```json
{
  "operation": "list"
}
```

### 使用条件
- 実験的機能のため `/experiment` コマンドで有効化が必要
- エージェント承認フローが必要

### 技術的詳細
- **状態保存**: `~/.aws/amazonq/.subagents/` ディレクトリ
- **プロセス管理**: PIDベースのモニタリング
- **エージェント制限**: 1エージェントにつき1タスク

### 安全な使用のためのベストプラクティス

#### 1. Agent設定での権限制限
```json
{
  "name": "safe-delegate-agent",
  "tools": [
    "fs_read",      // 読み取りのみ許可
    "execute_bash"  // 必要な場合のみ
  ],
  "allowedPaths": [
    "/home/user/projects/test-project"  // 特定のディレクトリのみ
  ]
}
```

#### 2. 基本的な使用方法
```
# チャットセッション内でAIに依頼
> rust-agentにsnake gameを作成するタスクを委任して

# AIがDelegateツールを呼び出し、バックグラウンドで実行される
```

#### 3. ステータス確認
```
# 特定のエージェントのステータスを確認
> rust-agentのステータスを確認して

# 全エージェントのステータスを確認
> 全エージェントのステータスを確認して
```

#### 4. 利用可能なエージェント一覧
```
# 利用可能なエージェントを表示
> 利用可能なエージェントを一覧表示して
```

### 推奨される使用シナリオ

#### シナリオ1: 大規模プロジェクトでの並行作業
メインの会話でアーキテクチャ設計を議論しながら、別のエージェントにテストコードの作成を委譲

#### シナリオ2: 複数のマイクロサービス開発
複数のマイクロサービスを並行して開発

### 実行フロー

```
1. タスク受領
   ↓
2. エージェント起動（バックグラウンド）
   ↓
3. タスク実行
   ↓
4. 状態保存（~/.aws/amazonq/.subagents/）
   ↓
5. 完了通知
```
   ↓
6. ...
   ↓
7. 完了報告
```

### 具体的な使用例

#### 例1: テストコード作成
```bash
You: このプロジェクトのテストを作成して

💼 Delegate Mode: タスクを分析中...

ステップ1: プロジェクト構造を分析
✓ 完了: 3つのモジュールを検出

ステップ2: 各モジュールのテストを作成
✓ 完了: module1_test.py 作成
✓ 完了: module2_test.py 作成
✓ 完了: module3_test.py 作成

ステップ3: テストを実行
✓ 完了: すべてのテストが通過

📊 タスク完了: 3つのテストファイルを作成しました
```

#### 例2: ドキュメント生成
```bash
You: このAPIのドキュメントを作成して

💼 Delegate Mode: タスクを分析中...

ステップ1: APIエンドポイントを抽出
✓ 完了: 5つのエンドポイントを検出

ステップ2: 各エンドポイントのドキュメントを作成
✓ 完了: GET /users
✓ 完了: POST /users
✓ 完了: GET /users/{id}
✓ 完了: PUT /users/{id}
✓ 完了: DELETE /users/{id}

ステップ3: OpenAPI仕様書を生成
✓ 完了: openapi.yaml 作成

📊 タスク完了: APIドキュメントを作成しました
```

#### 例3: リファクタリング
```bash
You: このコードをリファクタリングして

💼 Delegate Mode: タスクを分析中...

ステップ1: コードの問題点を特定
✓ 完了: 3つの改善点を検出
  - 重複コードの削減
  - 関数の分割
  - 型ヒントの追加

ステップ2: リファクタリングを実施
✓ 完了: 重複コードを共通関数に抽出
✓ 完了: 長い関数を3つに分割
✓ 完了: 型ヒントを追加

ステップ3: テストを実行
✓ 完了: すべてのテストが通過

📊 タスク完了: リファクタリングが完了しました
```

#### 例4: バグ修正
```bash
You: このバグを修正して

💼 Delegate Mode: タスクを分析中...

ステップ1: バグの原因を特定
✓ 完了: NullPointerExceptionを検出

ステップ2: 修正方法を検討
✓ 完了: null チェックを追加

ステップ3: 修正を実施
✓ 完了: コードを修正

ステップ4: テストを実行
✓ 完了: バグが修正されました

📊 タスク完了: バグ修正が完了しました
```

#### 例5: データ分析
```bash
You: このCSVファイルを分析して

💼 Delegate Mode: タスクを分析中...

ステップ1: データを読み込み
✓ 完了: 1,000行のデータを読み込み

ステップ2: 基本統計を計算
✓ 完了: 平均、中央値、標準偏差を計算

ステップ3: 可視化を作成
✓ 完了: ヒストグラムを作成
✓ 完了: 散布図を作成

ステップ4: レポートを生成
✓ 完了: analysis_report.md 作成

📊 タスク完了: データ分析が完了しました
```

### 制限事項と注意点

#### 制限事項
- **実行時間**: 長時間かかるタスクはタイムアウトする可能性があります
- **外部依存**: 外部サービスへのアクセスが必要な場合、適切な権限が必要です
- **ファイルアクセス**: Agent設定で許可されたパスのみアクセス可能です

#### 安全性に関する注意点
- **⚠️ 破壊的操作のリスク**: ファイルの削除や上書きが発生する可能性があります
- **⚠️ 意図しないコマンド実行**: システムに影響を与えるコマンドが実行される可能性があります
- **⚠️ データ損失のリスク**: バックアップなしでの使用は避けてください
- **⚠️ セキュリティリスク**: 機密情報を含むタスクには使用しないでください

#### 一般的な注意点
- **確認**: 重要な操作の前に確認を求めることがあります
- **エラー処理**: エラーが発生した場合、自動リトライしますが、失敗する可能性があります
- **リソース**: 複雑なタスクは多くのリソースを消費します

### トラブルシューティング

#### タスクが進まない場合
```
# チャットセッション内でステータスを確認
> エージェントのステータスを確認して

# ログを確認（別ターミナルで）
tail -f ~/.local/share/amazon-q/logs/q-cli.log
```

#### タイムアウトする場合
```bash
# タイムアウト時間を延長
q settings set chat.delegateTimeout 600
```

---

## ⚠️ 注意事項

### 一般的な注意事項
- 実験的機能は予告なく変更される可能性があります
- 本番環境での使用は推奨されません
- フィードバックは[GitHub Issues](https://github.com/aws/amazon-q-developer-cli/issues)で報告してください

### パフォーマンスへの影響
- Context Usage Indicator: 軽微な影響
- Thinking: 応答時間が若干増加
- Delegate Mode: タスクの複雑さに応じて時間がかかります

### プライバシーとセキュリティ
- 実験的機能の使用状況は、機能改善のために収集される場合があります
- 機密情報を含むタスクには注意してください

---

## 📚 関連ドキュメント

- [チャット機能](01_chat.md) - 基本的なチャット機能
- [Agent機能](02_agents.md) - Agent設定
- [設定ガイド](../03_configuration/README.md) - 設定方法
- [トラブルシューティング](../06_troubleshooting/02_common-issues.md) - 問題解決

---

**作成日**: 2025-10-11  
**最終更新**: 2025-10-11