# 自動化ツール

このディレクトリには、ドキュメントの品質保証を自動化するためのツールが含まれています。

---

## 📋 ツール一覧

| ツール | 用途 | 実行タイミング |
|--------|------|--------------|
| [count-files.sh](#count-filessh) | ファイル数の自動カウント | 新規作成時・定期チェック |
| [check-dates.sh](#check-datessh) | 日付整合性チェック | 更新時・定期チェック |
| [search-env-var.sh](#search-env-varsh) | 環境変数の使用箇所検索 | 削除前・更新時 |
| [validate_commands.sh](#validate_commandssh) | コマンド例の検証 | コミット時（自動） |
| [validate_config_keys.sh](#validate_config_keyssh) | 設定キーの検証 | コミット時（自動） |

---

## なぜこれらのツールが必要か

技術ドキュメントの品質を維持するには、**人間の目視だけでは限界**があります。

### 品質問題の例

- ファイル数の記載が古い → 読者の混乱
- Git更新日とドキュメント記載日の不一致 → 信頼性の低下
- 削除した環境変数への参照が残る → 動作しない設定例
- 存在しないコマンドの記載 → ユーザーのエラー
- 無効な設定キー → 設定が反映されない

### 自動化の効果

これらのツールにより、**手作業では見落としがちな問題を自動検出**できます：

- ✅ 100%の網羅性（全ファイルを漏れなくチェック）
- ✅ 一貫性の保証（同じ基準で判定）
- ✅ 効率化（数秒で完了）
- ✅ 継続的な品質維持（定期実行で劣化を防止）

---

## count-files.sh

### 目的

ドキュメント数の記載を常に正確に保つため。

### なぜ必要か

- README.mdには「総ドキュメント数: XX文書」と記載している
- ファイル追加・削除のたびに手動カウントは非効率で間違いやすい
- 古い数値が残ると読者に誤解を与える

### 使用方法

```bash
./scripts/count-files.sh
```

### 出力例

```
=== ファイル数カウント ===

全ファイル数: 118

カテゴリ別:
  01_for-users: 73 文書
  02_for-developers: 11 文書
  03_for-community: 14 文書
  04_issues: 1 文書
  05_meta: 14 文書

README除外: 97 文書

docs直下: 5 文書
```

### 活用シーン

- 新規ドキュメント作成後
- ドキュメント削除後
- README.md更新前
- 定期チェック（月次）

---

## check-dates.sh

### 目的

Git最終更新日とドキュメント記載日の整合性を保つため。

### なぜ必要か

- 各ドキュメントには「最終更新: YYYY-MM-DD」を記載している
- Gitの最終更新日と一致しない場合、以下の問題が発生：
  - 読者が「いつ更新されたか」を誤解する
  - 古い情報と新しい情報の区別がつかない
  - ドキュメントの信頼性が低下する

### 使用方法

```bash
# 全体をチェック
./scripts/check-dates.sh

# 特定ディレクトリのみ
./scripts/check-dates.sh docs/05_meta/
```

### 出力例

```
=== 日付整合性チェック ===

✅ docs/05_meta/01_CONTRIBUTING.md
   Git: 2025-10-26, Doc: 2025-10-26

❌ docs/01_for-users/README.md
   Git: 2025-10-26, Doc: 2025-10-19

チェック対象: 97 ファイル
一致: 95 ファイル
不一致: 2 ファイル
```

### 活用シーン

- ドキュメント更新後
- コミット前の最終チェック
- 定期チェック（週次）

---

## search-env-var.sh

### 目的

環境変数の使用箇所を完全に把握し、安全な削除・更新を可能にするため。

### なぜ必要か

- 環境変数を削除する際、参照が残っていると：
  - 読者が動作しない設定例を試してしまう
  - エラーの原因が分からず混乱する
  - ドキュメントの信頼性が損なわれる
- 手動検索では見落としのリスクがある

### 使用方法

```bash
./scripts/search-env-var.sh 環境変数名

# 例
./scripts/search-env-var.sh Q_DEBUG
```

### 出力例

```
=== 環境変数検索: Q_DEBUG ===

docs/01_for-users/03_configuration/06_environment-variables.md:45:
  export Q_DEBUG=true

docs/01_for-users/08_guides/06_troubleshooting.md:123:
  Q_DEBUG=true q chat "test"

使用箇所数: 2
```

### 活用シーン

- 環境変数削除前（必須）
- 環境変数名変更前
- 使用状況の把握
- ドキュメント整理時

---

## validate_commands.sh

### 目的

ドキュメント内のQ CLIコマンド例が正確であることを保証するため。

### なぜ必要か

- 存在しないコマンドやサブコマンドの記載は：
  - ユーザーがエラーに遭遇する
  - サポート問い合わせが増加する
  - ドキュメントの信頼性が失われる
- Q CLIのバージョンアップで廃止されたコマンドを検出できる

### 使用方法

```bash
./scripts/validate_commands.sh
```

### 検証内容

1. 実在するコマンドの取得
2. ドキュメントからコマンド抽出
3. チャット内コマンドとの混同検出
4. 存在しないサブコマンドの検証
5. オプション指定の正確性確認

### 活用シーン

- **自動実行**: Git commitフック（.git/hooks/pre-commit）
- 手動実行: ドキュメント更新後
- Q CLIバージョンアップ後

---

## validate_config_keys.sh

### 目的

設定ファイルのキーが正しいことを保証するため。

### なぜ必要か

- 無効な設定キーは：
  - 設定が反映されない（サイレントエラー）
  - ユーザーが「なぜ動かないのか」分からない
  - デバッグに時間がかかる
- JSON Schemaとの整合性を保つ必要がある

### 使用方法

```bash
./scripts/validate_config_keys.sh
```

### 検証内容

- Agent設定のキー検証
- MCP設定のキー検証
- グローバル設定のキー検証
- スキーマとの整合性確認

### 活用シーン

- **自動実行**: Git commitフック
- 設定例追加時
- スキーマ更新後

---

## 🔧 ツールの保守

### 更新が必要な場合

**Q CLIのバージョンアップ時**:
- validate_commands.sh: 新規コマンド・廃止コマンドの反映
- validate_config_keys.sh: 新規設定キー・廃止キーの反映

**ドキュメント構造変更時**:
- count-files.sh: カウント対象ディレクトリの調整
- check-dates.sh: 日付フォーマットの変更対応

### トラブルシューティング

**ツールが動作しない場合**:
1. 実行権限を確認: `chmod +x scripts/*.sh`
2. 依存コマンドを確認: `git`, `grep`, `find`
3. カレントディレクトリを確認: プロジェクトルートで実行

---

## 📖 関連ドキュメント

- **[自動化ツール使用ガイド](../docs/05_meta/07_automation-tools-guide.md)** - 詳細な使用方法とトラブルシューティング
- **[チェックリスト活用ガイド](../docs/05_meta/08_checklist-guide.md)** - ツールとチェックリストの組み合わせ
- **[品質保証概要](../docs/05_meta/05_quality-assurance-overview.md)** - 品質保証の全体像
- **[公開リソース一覧](../docs/05_meta/13_public-resources.md)** - 全リソースの一覧

---

最終更新: 2025-10-26
