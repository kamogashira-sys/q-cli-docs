[ホーム](../../README.md) > [ユーザーガイド](../README.md) > [コンテキスト管理ガイド](README.md) > 01 Essence

---

## 1. コンテキストの本質

---

### 1.1 コンテキストとは何か

#### AIとの対話における「文脈」の役割

コンテキスト（Context）とは、AIとの対話における「文脈」や「背景情報」のことです。人間同士の会話でも、相手が状況を理解していれば説明が不要になるように、AIに適切なコンテキストを提供することで、より正確で関連性の高い応答を得ることができます。

**例: コンテキストがある場合とない場合**

コンテキストなし:
```
あなた: このプロジェクトのREADMEを更新して
AI: どのプロジェクトですか？どのような内容を追加しますか？
```

コンテキストあり（README.mdを読み込み済み）:
```
あなた: このプロジェクトのREADMEを更新して
AI: 了解しました。現在のREADMEには「インストール方法」と「基本的な使い方」が
    記載されていますね。どのセクションを更新しますか？
```

💡 **初心者向けポイント**: コンテキストは「AIに事前に読んでもらう資料」と考えると分かりやすいです。

#### コンテキストがない場合の問題

コンテキストが不足していると、以下のような問題が発生します：

1. **繰り返しの説明が必要**
   - 毎回プロジェクトの概要を説明
   - 使用している技術スタックを説明
   - コーディング規約を説明

2. **応答の精度が低下**
   - プロジェクト固有の用語を理解できない
   - 既存のコード構造を考慮できない
   - プロジェクトの方針に沿わない提案

3. **開発効率の低下**
   - 説明に時間がかかる
   - 修正が必要な応答が増える
   - 期待した結果が得られない

📝 **実例**: 
```
# コンテキストなしの場合
あなた: Reactコンポーネントを作成して
AI: どのようなコンポーネントですか？（プロジェクトの構造が分からない）

# コンテキストありの場合（プロジェクトルールを読み込み済み）
あなた: Reactコンポーネントを作成して
AI: 了解しました。プロジェクトのルールに従って、
    - TypeScriptで実装
    - Functional Componentを使用
    - styled-componentsでスタイリング
    で作成しますね。
```

⚠️ **よくある誤解**: 「AIは賢いから説明しなくても分かる」→ 実際は、明示的にコンテキストを提供する必要があります。

#### コンテキストがもたらす価値

適切なコンテキストを提供することで、以下の価値が得られます：

1. **応答精度の向上**
   - プロジェクト固有の知識を活用
   - 既存のコード構造を理解
   - 一貫性のある提案

2. **開発効率の向上**
   - 説明の手間を削減
   - 修正の回数を削減
   - 期待通りの結果を得やすい

3. **品質の向上**
   - プロジェクトの方針に沿った提案
   - コーディング規約の遵守
   - ベストプラクティスの適用

4. **学習コストの削減**
   - 新しいメンバーへの説明が不要
   - プロジェクトの理解が容易
   - 一貫性のある開発

💡 **初心者向けポイント**: コンテキストは「一度設定すれば、毎回説明しなくて済む」という大きなメリットがあります。

---

### 1.2 Q CLIのコンテキストモデル

#### コンテキストウィンドウの概念

Q CLIでは、AIが一度に処理できる情報量に制限があります。この制限を「コンテキストウィンドウ」と呼びます。

```
┌─────────────────────────────────────┐
│   コンテキストウィンドウ（100%）    │
├─────────────────────────────────────┤
│                                     │
│  コンテキストファイル（最大75%）    │
│  ┌───────────────────────────────┐  │
│  │ README.md                     │  │
│  │ .amazonq/rules/**/*.md        │  │
│  │ その他のファイル              │  │
│  └───────────────────────────────┘  │
│                                     │
│  会話履歴・応答（残り25%以上）      │
│  ┌───────────────────────────────┐  │
│  │ ユーザーの質問                │  │
│  │ AIの応答                      │  │
│  └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

**重要な制限**:
- コンテキストファイルは**最大75%**まで
- 残り25%以上は会話履歴と応答に使用
- 75%を超えるファイルは自動的にドロップされる

💡 **初心者向けポイント**: コンテキストウィンドウは「AIの作業机の広さ」と考えると分かりやすいです。机が狭いと、たくさんの資料を広げられません。

#### トークンとコンテキストの関係

コンテキストウィンドウのサイズは「トークン」という単位で測定されます。

**トークンとは**:
- テキストを処理する最小単位
- 英語: 約4文字 = 1トークン
- 日本語: 約2-3文字 = 1トークン

**例**:
```
"Hello, World!" → 約3トークン
"こんにちは、世界！" → 約5-7トークン
```

**トークン使用量の確認**:
```bash
> /context show
Total: ~1100 tokens  # 現在の使用量
```

📝 **実例**: 
```
README.md (5KB) → 約1,250トークン
.amazonq/rules/security.md (2KB) → 約500トークン
合計: 約1,750トークン
```

⚠️ **注意**: ファイルサイズ（KB）とトークン数は必ずしも一致しません。日本語が多いとトークン数が増えます。

#### コンテキストの生存期間

コンテキストには「生存期間」があり、いつまで保持されるかが決まっています。

```
┌─────────────────────────────────────────────────────┐
│                  Agent起動                          │
│                     ↓                               │
│  ┌──────────────────────────────────────────────┐  │
│  │ Agent Resources読み込み                      │  │
│  │ - README.md                                  │  │
│  │ - .amazonq/rules/**/*.md                     │  │
│  └──────────────────────────────────────────────┘  │
│                     ↓                               │
│  ┌──────────────────────────────────────────────┐  │
│  │ セッション中（永続）                         │  │
│  │ - Agent Resourcesは保持される                │  │
│  │ - Session Contextは追加・削除可能           │  │
│  └──────────────────────────────────────────────┘  │
│                     ↓                               │
│  ┌──────────────────────────────────────────────┐  │
│  │ セッション終了                               │  │
│  │ - Agent Resourcesは次回も利用可能            │  │
│  │ - Session Contextは破棄される                │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**生存期間の種類**:

1. **永続的（Agent Resources）**
   - Agent設定に記載
   - セッション終了後も保持
   - 次回起動時に自動読み込み

2. **一時的（Session Context）**
   - `/context add`で追加
   - セッション中のみ有効
   - セッション終了で破棄

3. **永続的（Knowledge Bases）**
   - インデックス化して保存
   - セッション終了後も保持
   - 検索時のみトークン消費

💡 **初心者向けポイント**: Agent Resourcesは「常に持ち歩く資料」、Session Contextは「今だけ必要な資料」と考えると分かりやすいです。

---

### 1.3 3つのコンテキストアプローチ

Q CLIは、用途に応じて3つのコンテキストアプローチを提供しています。

#### Agent Resources - 永続的コンテキスト

**特徴**:
- Agent設定ファイルに記載
- Agent起動時に自動読み込み
- セッション間で永続
- トークンを常時消費

**適用場面**:
- プロジェクトのREADME
- コーディング規約
- プロジェクト固有のルール
- 常に参照する設定ファイル

**設定例**:
```json
{
  "resources": [
    "file://README.md",
    "file://.amazonq/rules/**/*.md"
  ]
}
```

💡 **初心者向けポイント**: 「毎回使う資料」はAgent Resourcesに設定しましょう。

#### Session Context - 一時的コンテキスト

**特徴**:
- `/context add`コマンドで追加
- 現在のセッションのみ有効
- セッション終了で破棄
- トークンを常時消費

**適用場面**:
- 一時的に参照するファイル
- 実験的な試行
- 特定のタスクのみで使用
- クイック確認

**使用例**:
```bash
> /context add docs/api-spec.md
Added 1 path(s) to context.
Note: Context modifications via slash command is temporary.
```

💡 **初心者向けポイント**: 「今だけ必要な資料」はSession Contextで追加しましょう。

#### Knowledge Bases - 検索可能コンテキスト

**特徴**:
- インデックス化して保存
- セマンティック検索が可能
- 検索時のみトークン消費
- 大規模なコンテンツに最適

**適用場面**:
- 大規模なコードベース（10MB以上）
- 広範なドキュメント
- 数千のファイル
- 参照頻度が低い資料

**使用例**:
```bash
# セットアップ
> q settings chat.enableKnowledge true

# コンテンツ追加
> /knowledge add /path/to/large-codebase --include "**/*.py"

# 検索
> /knowledge search "authentication patterns"
```

💡 **初心者向けポイント**: 「大量の資料から必要な部分だけ探したい」場合はKnowledge Basesを使いましょう。

#### アプローチ間の比較

| 項目 | Agent Resources | Session Context | Knowledge Bases |
|------|----------------|-----------------|-----------------|
| **永続性** | セッション間で永続 | セッション中のみ | セッション間で永続 |
| **トークン消費** | 常時消費 | 常時消費 | 検索時のみ |
| **設定方法** | Agent設定ファイル | `/context add` | `/knowledge add` |
| **適用場面** | 常に必要な資料 | 一時的な資料 | 大規模な資料 |
| **サイズ制限** | 75%まで | 75%まで | 制限なし |

#### 選択基準（決定フローチャート）

```
質問1: コンテンツは10MB以上、または数千ファイルか？
  ├─ Yes → Knowledge Basesを使用
  └─ No → 質問2へ

質問2: すべての会話で必要か？
  ├─ Yes → Agent Resourcesを使用
  └─ No → Session Contextを使用
```

📝 **実例**:

1. **README.md（5KB）、常に必要**
   - 質問1: No（10MB未満）
   - 質問2: Yes（常に必要）
   - **結論**: Agent Resources

2. **一時的なAPI仕様（2KB）、今だけ必要**
   - 質問1: No（10MB未満）
   - 質問2: No（一時的）
   - **結論**: Session Context

3. **大規模なコードベース（50MB）**
   - 質問1: Yes（10MB以上）
   - **結論**: Knowledge Bases

⚠️ **よくある間違い**: 「すべてAgent Resourcesに入れる」→ トークン制限を超えてしまいます。適切なアプローチを選びましょう。

---

## 📚 関連リソース

### 実践事例

AI駆動開発におけるコンテキスト活用の実践事例を紹介します。

#### AWS CDKプロジェクトでのコンテキスト活用

**参考資料**: [AI 駆動開発におけるコミュニティと AWS CDK の価値](https://speakerdeck.com/konokenj/community-and-cdk-at-ai-driven-development) (Kenji Kono)

この資料では、AWS CDKプロジェクトにおけるAI駆動開発の実践例を通じて、適切なコンテキスト設定がどのように開発効率を向上させるかが具体的に示されています。

**この事例から学べること**:

| 項目 | 内容 |
|------|------|
| **コンテキストの種類** | AWS CDK公式ドキュメント、コミュニティサンプルコード、プロジェクト固有のコード |
| **活用手法** | ドキュメントをAgent Resourcesとして設定、サンプルコードをKnowledge Basesで検索 |
| **効果** | CDK特有の構文やパターンをAIが理解し、適切なコード生成が可能に |
| **ポイント** | 公式ドキュメント + コミュニティリソースの組み合わせが効果的 |

**本ガイドとの対応**:

この事例は、本章で解説した以下の概念の実践例です：

- **3つのコンテキストアプローチ** - Agent ResourcesとKnowledge Basesの併用
- **コンテキストの提供方法** - 公式ドキュメントとコミュニティリソースの選定

💡 **学習のヒント**: この事例を参考に、自分のプロジェクトでどのようなコンテキストを提供すべきか考えてみましょう。

---

## 📖 ナビゲーション

**次へ**: [第2章: コンテキストの仕組みと管理](02_mechanism.md) →

---

最終更新: 2025-10-18

