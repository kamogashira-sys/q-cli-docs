[ホーム](../README.md) > [05_meta](README.md) > Quality Assurance

---

# Q CLI ドキュメント品質保証プロセス


## 目的

Q CLIドキュメントと実装の整合性を維持し、誤りの再発を防止する。

---

## 🎯 検証可能性の原則（2025-10-09追加）

### 基本原則

**すべての事実記述は検証可能でなければならない**

1. **コマンド出力例**: 実際にコマンドを実行して確認すること
2. **エラーメッセージ**: エラー条件を再現して確認すること
3. **設定ファイル例**: 実際の設定ファイルと照合すること
4. **動作説明**: 実際に操作して動作を確認すること
5. **デフォルト値**: ソースコードで確認すること

### 検証不可能な記述の扱い

検証不可能な記述（推測、想定）は以下のように明示すること：
- 「想定される動作」
- 「推奨される設定」
- 「一般的な使用例」

**禁止事項**: 検証せずに事実として記載すること

---

## 検証対象の定義

### P0（最優先）- 即座に検証が必要

| カテゴリ | 説明 | 検証方法 | リスク |
|---------|------|---------|--------|
| **コマンド出力例** | `q agent list`などの実行結果 | 実際にコマンド実行 | 実装変更で出力形式が変わる |
| **エラーメッセージ** | エラー発生時の表示内容 | エラー条件を再現 | 実装変更でメッセージが変わる |

### P1（高優先）- 早期に検証が必要

| カテゴリ | 説明 | 検証方法 | リスク |
|---------|------|---------|--------|
| **設定ファイル例** | settings.json、agent.jsonの記載例 | 実際の設定ファイル確認 | 項目追加・削除で不整合 |
| **動作説明** | 「～すると～になる」形式の記述 | 実際に動作確認 | 実装変更で動作が変わる |

### P2（中優先）- 計画的に検証

| カテゴリ | 説明 | 検証方法 | リスク |
|---------|------|---------|--------|
| **デフォルト値** | 設定項目のデフォルト値 | ソースコード確認 | 実装変更でデフォルト値が変わる |
| **ファイルパス** | 設定ファイルの配置場所 | 実際のパス確認 | OS依存、バージョン依存 |

---

## 検証方法の標準化

### 1. コマンド出力例の検証

**手順**:
1. ドキュメントに記載されているコマンドを特定
2. 実際にコマンドを実行
3. 出力をキャプチャ
4. ドキュメント記載と比較
5. 差異があれば記録

**検証項目**:
- 出力形式（ヘッダー、箇条書き、インデント）
- 出力内容（テキスト、数値、パス）
- 注釈の有無
- 表示順序

### 2. エラーメッセージの検証

**手順**:
1. ドキュメントに記載されているエラーメッセージを特定
2. エラー条件を再現
3. 実際のエラーメッセージを確認
4. ドキュメント記載と比較

### 3. 設定ファイル例の検証

**手順**:
1. ドキュメントに記載されている設定例を特定
2. 実際の設定ファイルと照合、または設定を適用して動作確認
3. ドキュメント記載と比較

### 4. 動作説明の検証

**手順**:
1. ドキュメントに記載されている動作説明を特定
2. 実際に操作を実行
3. 動作を確認
4. ドキュメント記載と比較

### 5. デフォルト値の検証

**手順**:
1. ドキュメントに記載されているデフォルト値を特定
2. ソースコードで確認、または設定なしで動作確認
3. ドキュメント記載と比較

---

## 検証記録の義務化

### トレーサビリティの確保

すべての事実記述には以下の検証記録を紐付けること：

1. **検証日時**: いつ検証したか
2. **検証方法**: どのように検証したか
3. **検証結果**: 一致/不一致/部分一致
4. **検証者**: 誰が検証したか

### 検証記録の保存場所

- 定期検証: `~/q-cli-work/verification-results/`
- 個別検証: ドキュメントのコミットメッセージに記載

---

## 定期照合プロセス

### 実施頻度

- **月次**: 環境変数と設定項目の照合
- **四半期**: 全ドキュメントの包括的レビュー
- **リリース前**: 新機能追加時の必須確認

### 照合対象

1. 環境変数（22項目）
2. 設定項目（35項目）
3. ファイルパス（5ファイル）

## チェックリストの活用

### 利用可能なチェックリスト

1. **環境変数確認用**: [env-vars-checklist.md](env-vars-checklist.md)
   - 環境変数名の正確性、値の形式、説明の完全性を確認
   - Q CLI固有の環境変数（19項目）とシステム環境変数（4項目）
   - 過去のバグパターンを基にした再発防止項目

2. **設定項目確認用**: [settings-checklist.md](settings-checklist.md)
   - Agent設定・MCP設定・グローバル設定の正確性を確認
   - hooks構造の確認（2025-10-27に31箇所のエラーを発見）
   - Stop Hookの説明確認（タイミング、用途、終了コード）

3. **ファイルパス確認用**: [file-paths-checklist.md](file-paths-checklist.md)
   - パス形式の確認（絶対パス、相対パス、ホームディレクトリ相対）
   - Q CLI関連パスの確認（設定ディレクトリ、Agent、MCP、Knowledge）
   - OS依存性とセキュリティの確認

### 実施タイミング

- 新規環境変数追加時
- 新規設定項目追加時
- ファイルパス変更時
- ドキュメント更新時

## 品質基準

### 必須要件

- [ ] 実装とドキュメントの整合性100%
- [ ] 環境変数の正確なカウント
- [ ] 設定項目の正確なカウント
- [ ] ファイルパスの正確性

### 推奨要件

- [ ] チェックリストの完全実施
- [ ] 作業ログの記録
- [ ] レビュー結果の文書化

---

## 検証基準の明確化

### 目的

合格/不合格の判断を客観的にするため、明確な基準を設定します。

### 合格条件

1. **完全性**
   - 全修正箇所が実施されている
   - 1箇所も漏れがない

2. **正確性**
   - 各修正内容が技術的に正確
   - スキーマと実装に準拠

3. **安全性**
   - 意図しない変更が含まれていない
   - 差分が全て正当

### 不合格条件

以下のいずれかに該当する場合は不合格：

1. **修正漏れ**
   - 1箇所でも修正漏れがある

2. **技術的誤り**
   - 修正内容に技術的な誤りがある
   - スキーマや実装と矛盾

3. **意図しない変更**
   - 計画外の変更が含まれている
   - 差分に不正な内容がある

### 判定方法

**客観的な判定**:
1. チェックリストで全項目を確認
2. 差分ファイルで変更内容を確認
3. 実装との照合で正確性を確認

**測定可能な基準**:
- 修正箇所数: 計画 vs 実際
- 合格箇所数: 実際 vs 期待
- 合格率: 合格箇所数 / 実際箇所数

### 実践例（2025-10-27）

**検証結果**:
- 計画修正箇所数: 29箇所
- 実際修正箇所数: 32箇所
- 合格箇所数: 32箇所
- 合格率: 100%

**判定**: ✅ 合格

**理由**:
1. 全32箇所が実施されている（完全性）
2. 全て技術的に正確（正確性）
3. 意図しない変更なし（安全性）

### 適用場面

- 検証作業
- レビュー作業
- 品質評価

---

## 一貫性の重要性

### 目的

同じ種類の修正を全て同じパターンで実施し、ユーザーの理解を容易にします。

### 一貫性を保つ方法

1. **修正パターンの明確化**
   - 最初の修正でパターンを確立
   - パターンを文書化
   - 全ての箇所で同じパターンを適用

2. **例外を作らない**
   - 「この箇所だけ特別」は許容しない
   - 全て統一する
   - 例外が必要な場合は理由を明記

3. **レビューで確認**
   - 全ての修正箇所を確認
   - パターンの一致を確認
   - 例外がないことを確認

### 実践例（2025-10-27）

**hooks構造修正（15箇所）**:
- 全て同じパターンで修正
- 配列 → オブジェクト
- trigger削除
- tool_matcher → matcher
- command配列 → 文字列

**Stop Hook説明修正（3箇所）**:
- 全て同じ説明に統一
- "Agent終了時" → "アシスタント応答完了時（会話ターン終了時）"

**hooks名修正（9箇所）**:
- 全てキャメルケース化
- agentspawn → agentSpawn
- userpromptsubmit → userPromptSubmit

**効果**:
- ユーザーの理解が容易
- メンテナンスが容易
- 品質が高い

### 適用場面

- 同じ種類の修正
- 複数ファイルの修正
- 説明文の統一

---

## 新機能追加時のプロセス

### 環境変数追加時

1. 実装に環境変数を追加
2. `docs/user-guide/03_configuration/06_environment-variables.md`を更新
3. `docs/user-guide/03_configuration/06_environment-variables.md`を更新
4. 環境変数確認用チェックリストを実施

### 設定項目追加時

1. Setting enumに項目を追加
2. `docs/07_reference/03_settings-reference.md`を更新
3. 設定項目確認用チェックリストを実施

## 参考資料

- 実装詳細計画書: `~/ai-plan/20251009/202510091406-implementation-plan.md`
- 品質向上対策案: `~/ai-work/20251009/202510091357-quality-improvement-plan.md`
- 最終報告書: `~/ai-work/20251009/202510091440-final-report.md`

---

## 第3部: 検証チェックリスト

### ドキュメント作成時のチェックリスト

#### 1. 事実記述の検証

- [ ] **コマンド出力例**: 実際にコマンドを実行して出力を確認した
- [ ] **エラーメッセージ**: エラー条件を再現してメッセージを確認した
- [ ] **設定ファイル例**: 実際の設定ファイルと照合した
- [ ] **動作説明**: 実際に操作して動作を確認した
- [ ] **デフォルト値**: ソースコードで確認した

#### 2. 検証記録の作成

- [ ] 検証日時を記録した
- [ ] 検証方法を記録した
- [ ] 検証結果を記録した
- [ ] 検証者を記録した

#### 3. 検証不可能な記述の明示

- [ ] 推測・想定は明示的に記載した（「想定される」「推奨される」など）
- [ ] 検証不可能な理由を記録した

---

### ドキュメントレビュー時のチェックリスト

#### 1. P0項目の検証（必須）

**コマンド出力例**:
- [ ] すべてのコマンド出力例を抽出した
- [ ] 各コマンドを実際に実行した
- [ ] 出力形式が一致することを確認した
- [ ] 差異があれば記録した

**エラーメッセージ**:
- [ ] すべてのエラーメッセージを抽出した
- [ ] 主要なエラー条件を再現した
- [ ] メッセージが一致することを確認した
- [ ] 差異があれば記録した

#### 2. P1項目の検証（推奨）

**設定ファイル例**:
- [ ] すべての設定例を抽出した
- [ ] 実際の設定ファイルと照合した
- [ ] 設定キーの正確性を確認した
- [ ] 差異があれば記録した

**動作説明**:
- [ ] 「～すると～になる」形式の記述を抽出した
- [ ] 主要な動作を実際に確認した
- [ ] 動作が一致することを確認した
- [ ] 差異があれば記録した

#### 3. P2項目の検証（計画的に）

**デフォルト値**:
- [ ] デフォルト値の記載を抽出した
- [ ] ソースコードで確認した
- [ ] 値が一致することを確認した
- [ ] 差異があれば記録した

---

### 定期検証時のチェックリスト

#### 月次検証（所要時間: 約30分）

- [ ] 環境変数の照合（22項目）
- [ ] 設定項目の照合（35項目）
- [ ] ファイルパスの照合（5ファイル）
- [ ] 新規追加項目の確認
- [ ] 検証結果の記録

#### 四半期検証（所要時間: 約2時間）

- [ ] P0項目の全件検証（コマンド出力例、エラーメッセージ）
- [ ] P1項目の重要箇所検証（設定例、動作説明）
- [ ] P2項目のサンプリング検証（デフォルト値）
- [ ] 検証結果の記録
- [ ] 修正計画の作成

#### リリース前検証（所要時間: 約1時間）

- [ ] 新機能のドキュメント検証
- [ ] 変更された機能のドキュメント更新確認
- [ ] P0項目の全件検証
- [ ] 検証結果の記録

---

## 関連ドキュメント

- [実装照合プロセス](03_IMPLEMENTATION_VERIFICATION.md) - ソースコードとの照合手順
- [コントリビューションガイドライン](01_CONTRIBUTING.md) - ドキュメント作成の基本ルール
- [タイトル統一ルール](04_TITLE_UNIFICATION_RULES.md) - タイトル表記の統一ルール

---
最終更新: 2025-10-26
