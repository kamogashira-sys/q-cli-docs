# 作業原則3案の比較検討

## 作成日時
2025-11-02 09:14 (JST)

## 目的
本サイトの信頼失墜を防ぐため、今後の作業計画書に必ず指定する重要な作業原則を策定する。

## 情報源
- docs/05_meta/04_quality-principles.md（9つの作業原則）
- docs/05_meta/07_lessons-learned.md（8+1件の問題と教訓）
- docs/05_meta/06_manual-checks.md（4つのチェックリスト、58項目）

---

## 案1: 簡潔版（3原則）

### コンセプト
**最も重要な3原則のみに絞り込み、Q CLIが即座に理解・実行できる形式**

### 作業原則

#### 原則1: 推測を排除する
- 「たぶん」「おそらく」などの推測表現を使わない
- すべてソースコード、スキーマ、実装で確認する
- 記憶に頼らず、必ず検証する

**具体的行動**:
```bash
# 設定項目を記述する前に
rg "設定項目名" --type rust
cat schemas/agent-v1.json | jq '.properties.設定項目名'

# 環境変数を記述する前に
rg "ENV_VAR" --type rust
./scripts/search-env-var.sh ENV_VAR

# コマンドを記述する前に
実際にコマンドを実行して出力を確認
```

#### 原則2: 全体を把握してから作業する
- 作業開始前に全体を把握する
- すべての警告・エラーを事前にリスト化する
- 段階的対応ではなく、一括対応を原則とする

**具体的行動**:
```bash
# ツールの出力は最後まで確認
./tool.sh | tee output.txt
# output.txtを全て確認してから作業開始

# 全警告を事前確認
python3 validator.py --all > warnings.txt
# warnings.txtを全て確認してから一括対応
```

#### 原則3: 削除操作は最も厳格に
- 削除前に必ず使用箇所を検索する
- 実装全体を検索する（ドキュメントだけでなくソースコードも）
- 影響範囲を完全に把握してから削除する

**具体的行動**:
```bash
# 環境変数を削除する前に
./scripts/search-env-var.sh 環境変数名
# 使用箇所が0件であることを確認

# 設定項目を削除する前に
rg "設定項目名" --type rust
grep -r "設定項目名" docs/
# すべての使用箇所を確認
```

### 評価

| 評価軸 | スコア | 理由 |
|--------|--------|------|
| 簡潔性 | ⭐⭐⭐⭐⭐ | 3原則のみで覚えやすい |
| 網羅性 | ⭐⭐ | 重要な原則のみ、他は省略 |
| 実行可能性 | ⭐⭐⭐⭐⭐ | 具体的なコマンド例あり |
| 効果 | ⭐⭐⭐⭐ | 過去の問題の80%をカバー |

**長所**:
- Q CLIが即座に理解できる
- 具体的な行動に落とし込める
- 過去の重大な問題をカバー

**短所**:
- 品質優先、テスト、自動化などの原則が含まれない
- 網羅性に欠ける

---

## 案2: 詳細版（9原則 + 5教訓）

### コンセプト
**すべての原則と教訓を網羅し、完全性を追求する形式**

### 作業原則

#### 第1部: 9つの基本原則

1. **品質優先の重要性**
   - 時間よりも正確性を優先
   - 品質を犠牲にした効率化は行わない
   - 必要な時間をかけて正確に作業する

2. **自動化の価値**
   - 機械的にチェックできる項目は自動化
   - scripts/配下のツール（5個）を活用
   - tools/verification/配下のツール（8個）を活用

3. **テストの重要性**
   - すべての変更をテスト
   - テストカバレッジ100%を維持
   - 既知のバグで必ずテスト

4. **段階的アプローチの効果**
   - 調査→更新→検証の段階的実施
   - 各段階で確認
   - リスクを分散

5. **統合の価値**
   - 既存ツールを活用
   - 重複を排除
   - 効率化

6. **CI/CD統合の重要性**
   - GitHub Actionsで自動実行
   - プッシュ時に自動検証
   - 品質ゲートを設定

7. **段階的改善の効果**
   - 問題を早期発見
   - 継続的に改善
   - 品質を向上

8. **作業効率を求めない**
   - 「時間がない」は理由にならない
   - 最初から正確に作業する方が効率的
   - 修正コストは元作業の1.0-8.0倍

9. **全体把握の徹底**
   - 作業開始前に全体を把握する
   - すべての警告・エラーを事前にリスト化
   - 一括対応を原則とする

#### 第2部: 5つの重要教訓

1. **推測は禁止**
   - 必ずソースコードで確認
   - JSON Schema確認
   - 動作確認

2. **コマンドは必ずテスト**
   - 異常パターンを検出
   - ドライランモードを実装
   - 出力内容を確認

3. **削除操作は最も厳格に**
   - 実装全体を必ず検索
   - 影響範囲を完全に把握
   - レビュープロセスを経る

4. **ツールは万能ではない**
   - 定期的な検証が必要
   - 手動チェックも併用
   - 既知のバグでテスト

5. **境界値テストの徹底**
   - 想定外のパターンを考慮
   - エッジケースを網羅
   - 文脈を考慮

### 評価

| 評価軸 | スコア | 理由 |
|--------|--------|------|
| 簡潔性 | ⭐⭐ | 14原則で多すぎる |
| 網羅性 | ⭐⭐⭐⭐⭐ | すべての原則と教訓を網羅 |
| 実行可能性 | ⭐⭐⭐ | 抽象的な表現が多い |
| 効果 | ⭐⭐⭐⭐⭐ | 過去の問題の100%をカバー |

**長所**:
- 完全性が高い
- すべての原則と教訓を網羅
- 長期的な品質保証に有効

**短所**:
- Q CLIが一度に理解するには多すぎる
- 具体的な行動に落とし込みにくい
- 優先順位が不明確

---

## 案3: チェックリスト版（4段階検証）

### コンセプト
**実行可能な具体的手順をチェックリスト形式で提示する形式**

### 作業原則

#### 段階1: 作業開始前の検証（必須）

**全体把握**:
- [ ] ツールの出力を最後まで確認し、全警告・エラーをリスト化
- [ ] 作業対象の全ファイルをリスト化
- [ ] 影響範囲を特定

**情報収集**:
- [ ] ソースコードを確認（推測禁止）
  ```bash
  rg "対象項目" --type rust
  ```
- [ ] JSON Schemaを確認
  ```bash
  cat schemas/agent-v1.json | jq '.properties.対象項目'
  ```
- [ ] 既存ドキュメントを確認
  ```bash
  grep -r "対象項目" docs/
  ```

#### 段階2: 作業中の検証（必須）

**実装照合**:
- [ ] ソースコードと一致するか確認
- [ ] プロパティ名が正確か確認
- [ ] デフォルト値が正確か確認
- [ ] 環境変数名が正確か確認

**動作確認**:
- [ ] コマンドを実際に実行
  ```bash
  q chat "test command"
  ```
- [ ] 出力を確認
- [ ] エラーがないことを確認
- [ ] 終了コードを確認

**削除操作（該当する場合）**:
- [ ] 使用箇所を検索
  ```bash
  ./scripts/search-env-var.sh 環境変数名
  grep -r "対象項目" docs/
  rg "対象項目" --type rust
  ```
- [ ] 使用箇所が0件であることを確認
- [ ] 影響範囲を完全に把握

#### 段階3: 作業完了後の検証（必須）

**自動化ツールで検証**:
- [ ] ファイル数チェック
  ```bash
  ./scripts/count-files.sh
  ```
- [ ] 日付チェック
  ```bash
  ./scripts/check-dates.sh docs/
  ```
- [ ] 連続区切り線チェック
  ```bash
  ./tools/check-consecutive-separators.sh
  ```
- [ ] 環境変数バリデーション
  ```bash
  cd tools/verification
  python3 validators/env_validator.py ../../docs
  ```
- [ ] 統合バリデーション
  ```bash
  python3 validators/v2_validator.py ../../docs
  ```

**手動チェック**:
- [ ] リンク切れがないか確認
- [ ] 表記が統一されているか確認
- [ ] 日付が更新されているか確認

#### 段階4: コミット前の最終確認（必須）

**品質確認**:
- [ ] すべての自動化ツールで警告0件
- [ ] すべての手動チェック項目をクリア
- [ ] 作業記録を作成

**Git操作**:
- [ ] コミットメッセージに変更理由を明記
- [ ] 作業記録ファイルを含める
- [ ] pre-commitフックをパス

### 評価

| 評価軸 | スコア | 理由 |
|--------|--------|------|
| 簡潔性 | ⭐⭐⭐ | 4段階で構造化 |
| 網羅性 | ⭐⭐⭐⭐ | 重要な項目を網羅 |
| 実行可能性 | ⭐⭐⭐⭐⭐ | チェックリスト形式で実行しやすい |
| 効果 | ⭐⭐⭐⭐⭐ | 過去の問題の95%をカバー |

**長所**:
- チェックリスト形式で実行しやすい
- 具体的なコマンド例あり
- 段階的に検証できる
- 漏れを防止できる

**短所**:
- 項目数が多い（約30項目）
- すべてを毎回実行するのは時間がかかる

---

## 比較表

| 項目 | 案1: 簡潔版 | 案2: 詳細版 | 案3: チェックリスト版 |
|------|-------------|-------------|---------------------|
| **原則数** | 3原則 | 14原則 | 4段階30項目 |
| **簡潔性** | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| **網羅性** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **実行可能性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **効果** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Q CLI適合性** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **学習コスト** | 低 | 高 | 中 |
| **実行時間** | 短 | - | 中 |

---

## 推奨案

### 🏆 推奨: 案3（チェックリスト版）

**理由**:

1. **実行可能性が最も高い**
   - チェックリスト形式で漏れを防止
   - 具体的なコマンド例あり
   - 段階的に検証できる

2. **効果が実証されている**
   - 過去の問題の95%をカバー
   - 4つの手動チェックリストを統合
   - 自動化ツールとの連携

3. **Q CLIに適している**
   - 段階的に指示できる
   - チェックボックスで進捗管理
   - 具体的な行動に落とし込める

4. **バランスが良い**
   - 簡潔性と網羅性のバランス
   - 実行時間と効果のバランス
   - 学習コストと効果のバランス

### 使用方法

**作業計画書への記載例**:
```markdown
## 作業原則

本作業では、以下の4段階検証を必ず実施してください：

### 段階1: 作業開始前の検証
- [ ] ツールの出力を最後まで確認
- [ ] ソースコードを確認（推測禁止）
- [ ] JSON Schemaを確認
...

### 段階2: 作業中の検証
...

### 段階3: 作業完了後の検証
...

### 段階4: コミット前の最終確認
...
```

---

## 代替案

### 案1を推奨する場合

**適用場面**:
- 緊急の修正作業
- 小規模な変更
- Q CLIが初めて作業する場合

**理由**:
- 最も重要な3原則に絞り込み
- 即座に理解・実行できる
- 過去の重大な問題をカバー

### 案2を推奨する場合

**適用場面**:
- 大規模なリファクタリング
- 新規機能の追加
- 長期的な品質保証

**理由**:
- すべての原則と教訓を網羅
- 完全性が最も高い
- 長期的な品質保証に有効

---

## 実装計画

### フェーズ1: 案3の導入（今週）
1. 作業計画書テンプレートに案3を追加
2. Q CLIに案3を指示
3. 実際の作業で効果を検証

### フェーズ2: 効果測定（来週）
1. 作業記録から効果を測定
2. 問題発生率を確認
3. 改善点を抽出

### フェーズ3: 改善（再来週）
1. 効果測定結果を反映
2. チェックリストを最適化
3. 案1、案2との併用を検討

---

## 結論

**案3（チェックリスト版）を推奨**

理由:
- 実行可能性が最も高い
- 効果が実証されている
- Q CLIに最適
- バランスが良い

ただし、状況に応じて案1、案2との併用も検討する。

---

最終更新: 2025-11-02 09:14 (JST)
