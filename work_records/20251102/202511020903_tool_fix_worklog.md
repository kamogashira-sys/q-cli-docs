# 作業記録 - チェックツールのバグ修正

## 作業開始時刻
2025-11-02 09:03 (JST)

## 作業内容
連続区切り線チェックツールのバグ修正

## 問題点
- 現在の条件: `NR - prev_line <= 2`
- 問題: 3行差（空行2つ）を検出できない
- 結果: 今回修正した16箇所すべてが検出されなかった

## 修正内容

### 改善したロジック
```bash
# 修正前
if (prev == "---" && NR - prev_line <= 2)

# 修正後
if (prev == "---") {
    gap = NR - prev_line
    if (gap <= 3) {
        # 間の行がすべて空行かチェック
        all_blank = 1
        for (i = prev_line + 1; i < NR; i++) {
            if (lines[i] !~ /^[[:space:]]*$/) {
                all_blank = 0
                break
            }
        }
        if (all_blank) {
            # 検出
        }
    }
}
```

### 改善ポイント
1. **3行差まで検出**: `gap <= 3` に変更
2. **文脈を考慮**: 間の行がすべて空行かチェック
3. **誤検出を防止**: 意味のあるコンテンツがある場合は検出しない

## テスト結果

### ✅ 正常なパターン（検出されない）
1. タイトルを挟んだ区切り線
```markdown
---

# Title


---
```

2. ナビゲーションリンクを挟んだ区切り線
```markdown
---

**Next**: [Link](link.md)
---
```

### ❌ 異常なパターン（検出される）
1. 直接連続
```markdown
---
---
```

2. 空行1つ
```markdown
---

---
```

3. 空行2つ
```markdown
---


---
```

## 検証結果
- ✅ 現在のドキュメント: 問題なし
- ✅ 直接連続: 検出成功
- ✅ 空行1つ: 検出成功
- ✅ 空行2つ: 検出成功
- ✅ タイトルあり: 誤検出なし
- ✅ リンクあり: 誤検出なし

## 成果物
- 修正済みツール: `tools/check-consecutive-separators.sh`

## 作業終了時刻
2025-11-02 09:10 (JST)
